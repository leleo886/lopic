import{r as k,s as ie}from"./services-DL6wjq8D.js";import{a as L}from"./index-FacjB4mQ.js";import{g as S}from"./errorMessages-Dl98_79z.js";import{d as ue,C as de,j as _e,c as E,a as m,l as s,i as r,t as i,y as n,E as v,P as ce,Q as pe,R as me,F as T,r as V,O as ve,f as d,e as fe,H as ge,J as x,U as xe,I as u,o as C,x as B,_ as be}from"./index-DmJlHfzr.js";import"./axios-Cl3Sb8ms.js";const ye={class:"roles-view"},he={class:"roles-content card"},we={class:"search-filter"},ke={class:"filter-buttons"},Ce={class:"sort-controls"},ze={class:"sort-label"},Re=ue({__name:"RolesView",setup(Fe){const{t:e}=de(),I=d(!1),M=d(!1),A=d([]),$=fe(()=>".jpg,.jpeg,.png,.bmp,.tiff,.tif,.webp,.gif".split(",").map(a=>a.trim()).filter(a=>a!=="")),f=d({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:o=>`共 ${o} 条记录`}),N=d([]),D=d({}),O=d(""),z=d("created_at"),R=d("desc"),y=d(!1),h=d(),w=d(null),t=ge({name:"",description:"",allowed_extensions:[".jpg",".png"],gallery_open:!1,max_albums_per_user:0,max_file_size_mb:0,max_files_per_upload:0,max_storage_size_mb:0,storage_name:"local"}),q={name:[{required:!0,message:()=>e("roles.enterRoleName"),trigger:"blur"}]},H=[{title:"ID",dataIndex:"id",key:"id",fixed:"start"},{title:e("roles.roleName"),dataIndex:"name",key:"name"},{title:e("roles.roleDescription"),dataIndex:"description",key:"description",ellipsis:!0},{title:e("roles.userCount"),key:"usersCount",slots:{customRender:"usersCount"}},{title:e("roles.maxFilesPerUpload"),dataIndex:"max_files_per_upload",key:"max_files_per_upload"},{title:e("roles.maxFileSizeMb"),dataIndex:"max_file_size_mb",key:"max_file_size_mb"},{title:e("roles.maxAlbumsPerUser"),dataIndex:"max_albums_per_user",key:"max_albums_per_user"},{title:e("roles.allowedExtensions"),dataIndex:"allowed_extensions",key:"allowed_extensions",ellipsis:!0,width:120},{title:e("roles.storageLimit"),dataIndex:"max_storage_size_mb",key:"max_storage_size_mb"},{title:e("roles.storageName"),dataIndex:"storage_name",key:"storage_name"},{title:e("roles.createdAt"),key:"created_at",slots:{customRender:"created_at"}},{title:e("roles.updatedAt"),key:"updated_at",slots:{customRender:"updated_at"}},{title:"操作",key:"actions",slots:{customRender:"actions"}}],g=async()=>{try{I.value=!0;const o=await k.getRoles({page:f.value.current,page_size:f.value.pageSize,searchkey:O.value,orderby:z.value,order:R.value});N.value=o.data,f.value.total=o.data.length,J()}catch(o){const a=o.response?.data?.code,c=a?S(a):e("roles.fetchFailed");x.error(c)}finally{I.value=!1}},J=async()=>{try{const o=await k.getRolesUsersCount();D.value=o.data}catch(o){console.error("Failed to fetch roles users count:",o)}},K=async()=>{try{M.value=!0;const o=await ie.getStorages({page_size:100});A.value=o.data}catch(o){console.error("Failed to fetch storages:",o);const a=o.response?.data?.code,c=a?S(a):e("storages.fetchFailed");x.error(c)}finally{M.value=!1}},Q=o=>{O.value=o,f.value.current=1,g()},P=()=>{f.value.current=1,g()},G=()=>{O.value="",z.value="created_at",R.value="desc",f.value.current=1,g()},W=o=>{f.value=o,g()},X=o=>{w.value=o,t.name=o.name,t.description=o.description,t.allowed_extensions=o.allowed_extensions,t.gallery_open=o.gallery_open,t.max_albums_per_user=o.max_albums_per_user,t.max_file_size_mb=o.max_file_size_mb,t.max_files_per_upload=o.max_files_per_upload,t.max_storage_size_mb=o.max_storage_size_mb,t.storage_name=o.storage_name,y.value=!0},Y=(o,a)=>{xe.confirm({title:e("roles.confirmDelete"),content:e("roles.deleteContent",{name:a}),onOk:async()=>{try{await k.deleteRole(o),x.success(e("roles.deleteSuccess")),g()}catch(c){const _=c.response?.data?.code,b=_?S(_):e("roles.deleteFailed");x.error(b)}}})},Z=async()=>{if(h.value)try{await h.value.validate(),w.value?(await k.updateRole(w.value.id,t),x.success(e("roles.updateSuccess"))):(await k.createRole(t),x.success(e("roles.createSuccess"))),j(),g()}catch(o){const a=o.response?.data?.code,c=a?S(a):e("roles.saveFailed");x.error(c)}},j=()=>{y.value=!1,w.value=null,t.name="",t.description="",t.allowed_extensions=[".jpg",".jpeg",".png",".gif",".webp"],t.gallery_open=!1,t.max_albums_per_user=100,t.max_file_size_mb=10,t.max_files_per_upload=10,t.max_storage_size_mb=1024,t.storage_name="local",h.value&&h.value.resetFields()};return _e(()=>{g(),K()}),(o,a)=>{const c=u("a-input-search"),_=u("a-select-option"),b=u("a-select"),F=u("a-button"),ee=u("a-table"),ae=u("a-input"),p=u("a-form-item"),le=u("a-textarea"),te=u("a-switch"),se=u("a-tooltip"),U=u("a-input-number"),oe=u("a-form"),re=u("a-modal");return C(),E("div",ye,[m("div",he,[m("div",we,[s(c,{placeholder:r(e)("roles.search"),class:"search-input",onSearch:Q},null,8,["placeholder"]),m("div",ke,[m("div",Ce,[m("span",ze,i(r(e)("roles.sort")),1),s(b,{value:z.value,"onUpdate:value":a[0]||(a[0]=l=>z.value=l),class:"sort-select",style:{width:"120px"},onChange:P},{default:n(()=>[s(_,{value:"created_at"},{default:n(()=>[v(i(r(e)("roles.createdAt")),1)]),_:1}),s(_,{value:"updated_at"},{default:n(()=>[v(i(r(e)("roles.updatedAt")),1)]),_:1}),s(_,{value:"name"},{default:n(()=>[v(i(r(e)("roles.roleName")),1)]),_:1})]),_:1},8,["value"]),s(b,{value:R.value,"onUpdate:value":a[1]||(a[1]=l=>R.value=l),class:"sort-select",style:{width:"80px"},onChange:P},{default:n(()=>[s(_,{value:"desc"},{default:n(()=>[v(i(r(e)("admin.albums.sortOptions.desc")),1)]),_:1}),s(_,{value:"asc"},{default:n(()=>[v(i(r(e)("admin.albums.sortOptions.asc")),1)]),_:1})]),_:1},8,["value"])]),s(F,{type:"text",onClick:G},{default:n(()=>[v(i(r(e)("roles.resetFilters")),1)]),_:1}),s(F,{type:"primary",onClick:a[2]||(a[2]=l=>y.value=!0),class:"create-button"},{icon:n(()=>[s(r(ce))]),default:n(()=>[v(" "+i(r(e)("roles.createRole")),1)]),_:1})])]),s(ee,{columns:H,"data-source":N.value,loading:I.value,pagination:f.value,onChange:W,"row-key":"id"},{usersCount:n(({record:l})=>[m("span",null,i(D.value[l.name]),1)]),created_at:n(({record:l})=>[m("span",null,i(r(L)(l.created_at)),1)]),updated_at:n(({record:l})=>[m("span",null,i(r(L)(l.updated_at)),1)]),actions:n(({record:l})=>[s(F,{type:"text",size:"small",onClick:ne=>X(l)},{default:n(()=>[s(r(pe))]),_:1},8,["onClick"]),s(F,{type:"text",size:"small",danger:"",onClick:ne=>Y(l.id,l.name)},{default:n(()=>[s(r(me))]),_:1},8,["onClick"])]),_:1},8,["data-source","loading","pagination"]),a[13]||(a[13]=m("span",{class:"tip"},"'-1' 表示无限制",-1))]),s(re,{open:y.value,"onUpdate:open":a[12]||(a[12]=l=>y.value=l),title:w.value?r(e)("roles.edit"):r(e)("roles.createRole"),onOk:Z,onCancel:j},{default:n(()=>[s(oe,{model:t,rules:q,ref_key:"roleFormRef",ref:h},{default:n(()=>[s(p,{name:"name",label:r(e)("roles.roleName")},{default:n(()=>[s(ae,{value:t.name,"onUpdate:value":a[3]||(a[3]=l=>t.name=l),placeholder:r(e)("roles.enterRoleName")},null,8,["value","placeholder"])]),_:1},8,["label"]),s(p,{name:"description",label:r(e)("roles.roleDescription")},{default:n(()=>[s(le,{value:t.description,"onUpdate:value":a[4]||(a[4]=l=>t.description=l),placeholder:r(e)("roles.enterRoleDescription"),rows:"3"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(p,{name:"allowed_extensions",label:r(e)("roles.allowedExtensions")},{default:n(()=>[s(b,{value:t.allowed_extensions,"onUpdate:value":a[5]||(a[5]=l=>t.allowed_extensions=l),mode:"multiple",placeholder:r(e)("roles.selectAllowedExtensions"),style:{width:"100%"}},{default:n(()=>[(C(!0),E(T,null,V($.value,l=>(C(),B(_,{key:l,value:l},{default:n(()=>[v(i(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),s(p,{name:"gallery_open",label:r(e)("roles.galleryOpen")},{default:n(()=>[s(te,{checked:t.gallery_open,"onUpdate:checked":a[6]||(a[6]=l=>t.gallery_open=l)},null,8,["checked"]),s(se,{class:"gallery-tooltip",color:"var(--primary-color)",placement:"top",title:r(e)("albums.galleryTooltip")},{default:n(()=>[s(r(ve))]),_:1},8,["title"])]),_:1},8,["label"]),s(p,{name:"max_albums_per_user",label:r(e)("roles.maxAlbumsPerUser")},{default:n(()=>[s(U,{value:t.max_albums_per_user,"onUpdate:value":a[7]||(a[7]=l=>t.max_albums_per_user=l),placeholder:r(e)("roles.enterMaxAlbums")},null,8,["value","placeholder"])]),_:1},8,["label"]),s(p,{name:"max_file_size_mb",label:r(e)("roles.maxFileSizeMb")},{default:n(()=>[s(U,{value:t.max_file_size_mb,"onUpdate:value":a[8]||(a[8]=l=>t.max_file_size_mb=l),placeholder:r(e)("roles.enterMaxFileSize")},null,8,["value","placeholder"])]),_:1},8,["label"]),s(p,{name:"max_files_per_upload",label:r(e)("roles.maxFilesPerUpload")},{default:n(()=>[s(U,{value:t.max_files_per_upload,"onUpdate:value":a[9]||(a[9]=l=>t.max_files_per_upload=l),placeholder:r(e)("roles.enterMaxFilesPerUpload")},null,8,["value","placeholder"])]),_:1},8,["label"]),s(p,{name:"max_storage_size_mb",label:r(e)("roles.storageLimit")},{default:n(()=>[s(U,{value:t.max_storage_size_mb,"onUpdate:value":a[10]||(a[10]=l=>t.max_storage_size_mb=l),placeholder:r(e)("roles.enterStorageLimit")},null,8,["value","placeholder"])]),_:1},8,["label"]),s(p,{name:"storage_name",label:r(e)("roles.storageName")},{default:n(()=>[s(b,{value:t.storage_name,"onUpdate:value":a[11]||(a[11]=l=>t.storage_name=l),placeholder:r(e)("roles.selectStorage"),loading:M.value},{default:n(()=>[(C(!0),E(T,null,V(A.value,l=>(C(),B(_,{key:l.name,value:l.name},{default:n(()=>[v(i(l.name)+" ("+i(l.type)+") ",1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder","loading"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title"])])}}}),Ee=be(Re,[["__scopeId","data-v-f4754154"]]);export{Ee as default};
