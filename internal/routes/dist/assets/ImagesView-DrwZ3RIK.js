import{i as L,u as Me,s as oe}from"./services-DL6wjq8D.js";import{u as J}from"./websocket-BtUuRO1W.js";import{a as K,f as Fe,g as Ve}from"./index-FacjB4mQ.js";import{g as O}from"./errorMessages-CmCcllaB.js";import{I as De}from"./ImagePreviewModal-CzH7Dco5.js";import{l as s,K as Ae,d as Ne,C as Re,j as Te,J as h,L as Ee,c as w,a as m,i as a,x as l,E as r,t as o,R as ie,k as q,F as Y,r as Z,f as u,U as re,I as b,o as y,s as Be,_ as $e}from"./index-QwL2gIV2.js";import"./axios-Cl3Sb8ms.js";var je={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M342 88H120c-17.7 0-32 14.3-32 32v224c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V168h174c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zm578 576h-48c-8.8 0-16 7.2-16 16v176H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h222c17.7 0 32-14.3 32-32V680c0-8.8-7.2-16-16-16zM342 856H168V680c0-8.8-7.2-16-16-16h-48c-8.8 0-16 7.2-16 16v224c0 17.7 14.3 32 32 32h222c8.8 0 16-7.2 16-16v-48c0-8.8-7.2-16-16-16zM904 88H682c-8.8 0-16 7.2-16 16v48c0 8.8 7.2 16 16 16h174v176c0 8.8 7.2 16 16 16h48c8.8 0 16-7.2 16-16V120c0-17.7-14.3-32-32-32z"}}]},name:"expand",theme:"outlined"};function de(k){for(var e=1;e<arguments.length;e++){var v=arguments[e]!=null?Object(arguments[e]):{},p=Object.keys(v);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(v).filter(function(_){return Object.getOwnPropertyDescriptor(v,_).enumerable}))),p.forEach(function(_){He(k,_,v[_])})}return k}function He(k,e,v){return e in k?Object.defineProperty(k,e,{value:v,enumerable:!0,configurable:!0,writable:!0}):k[e]=v,k}var ee=function(e,v){var p=de({},e,v.attrs);return s(Ae,de({},p,{icon:je}),null)};ee.displayName="ExpandOutlined";ee.inheritAttrs=!1;const Le={class:"images-view"},Je={class:"images-content card"},Ke={class:"search-filter"},qe={class:"search-fields"},We={class:"field-filter"},Ge={class:"filter-buttons"},Qe={class:"sort-controls"},Xe={class:"sort-label"},Ye={key:0,class:"batch-operations"},Ze={key:1,class:"deleting-status"},ea=["onClick"],aa=["onClick"],ta={key:0},la=["onClick"],sa={key:0},na=["href"],oa={key:1},ia={class:"batch-update-info"},ra=Ne({__name:"ImagesView",setup(k){const{t:e}=Re(),v=u(!1),p=u(!1),_=u({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:i=>e("pagination.total",{total:i})}),g=u([]),A=u([]),P=u(""),M=u(""),F=u(""),N=u("created_at"),R=u("desc"),T=u(!1),ue=u(""),W=u(null),E=u(!1),U=u({}),B=u(!1),S=u({}),$=u(!1),V=u({}),D=u(!1),z=u({storage_name:""}),ae=u([]),ce=[{title:"ID",dataIndex:"id",key:"id",width:80},{title:e("admin.images.image"),key:"image",slots:{customRender:"image"}},{title:e("admin.images.filename"),dataIndex:"original_name",key:"original_name",ellipsis:!0},{title:e("admin.images.fileSize"),key:"size",slots:{customRender:"size"}},{title:e("admin.images.mimeType"),dataIndex:"mime_type",key:"mime_type"},{title:e("admin.images.user"),key:"user_id",slots:{customRender:"user_id"}},{title:e("admin.images.tags"),key:"tags",slots:{customRender:"tags"},ellipsis:!0,width:150},{title:e("admin.images.albums"),key:"albums",slots:{customRender:"albums"}},{title:e("admin.images.storageName"),key:"storage_name",slots:{customRender:"storage_name"}},{title:e("admin.images.createdAt"),key:"created_at",slots:{customRender:"created_at"}},{title:e("admin.images.actions"),key:"actions",slots:{customRender:"actions"}}],I=async()=>{try{v.value=!0;const i=await L.getImages({page:_.value.current,page_size:_.value.pageSize,searchkey:P.value,orderby:N.value,order:R.value,field:M.value,value:F.value});A.value=i.data.images,_.value.total=i.data.total}catch(i){const t=i.response?.data?.code,d=t?O(t):e("admin.images.fetchImagesFailed");h.error(d)}finally{v.value=!1}},G=i=>{i instanceof Event||(P.value=i),_.value.current=1,I()},te=()=>{_.value.current=1,I()},me=()=>{P.value="",M.value="",F.value="",N.value="created_at",R.value="desc",_.value.current=1,I()},ge=i=>{_.value=i,g.value=[],I()},ve=i=>{g.value=i},pe=()=>{g.value.length!==0&&re.confirm({title:e("admin.images.confirmBatchDeleteTitle"),content:e("admin.images.confirmBatchDeleteContent",{count:g.value.length}),onOk:async()=>{try{p.value=!0,L.deleteImages(g.value),h.warning(e("admin.images.batchDeleteStarted")),g.value=[]}catch(i){const t=i.response?.data?.code,d=t?O(t):e("admin.images.batchDeleteFailed");h.error(d),p.value=!1}}})},_e=async i=>{try{const t=await Me.getUser(i);t&&(U.value=t.data||{},E.value=!0)}catch(t){const d=t.response?.data?.code,c=d?O(d):e("admin.images.fetchUserFailed");h.error(c)}},le=()=>{E.value=!1,U.value={}},fe=i=>{const t=A.value.find(d=>d.albums?.some(c=>c.id===i));t&&(S.value=t.albums?.find(d=>d.id===i)||{},B.value=!0)},se=()=>{B.value=!1,S.value={}},he=async i=>{try{const t=await oe.getStorageByName(i);t&&(V.value=t.data||{},$.value=!0)}catch(t){const d=t.response?.data?.code,c=d?O(d):e("admin.images.fetchStorageFailed");h.error(c)}},ne=()=>{$.value=!1,V.value={}},be=async()=>{try{const i=await oe.getStorages({page:1,page_size:100});i&&(ae.value=i.data)}catch(i){const t=i.response?.data?.code,d=t?O(t):e("admin.images.fetchStoragesFailed");h.error(d)}},ye=async()=>{if(g.value.length!==0){if(!z.value.storage_name){h.error(e("admin.images.selectStorageRequired"));return}try{await L.updateImageStorage({ids:g.value,storage_name:z.value.storage_name}),h.success(e("admin.images.batchUpdateStorageSuccess")),g.value=[],D.value=!1,z.value.storage_name="",I()}catch(i){const t=i.response?.data?.code,d=t?O(t):e("admin.images.batchUpdateStorageFailed");h.error(d)}}},we=()=>{D.value=!1,z.value.storage_name=""},Ce=i=>{W.value=i,T.value=!0},ke=i=>{re.confirm({title:e("admin.images.confirmDeleteTitle"),content:e("admin.images.confirmDeleteContent"),onOk:async()=>{try{p.value=!0,L.deleteImages([i]),h.warning(e("admin.images.deleteStarted"))}catch(t){const d=t.response?.data?.code,c=d?O(d):e("admin.images.deleteImageFailed");h.error(c),p.value=!1}}})},Se=()=>{T.value=!1,ue.value="",W.value=null};return Te(()=>{I(),be(),J.connect(),J.on("deleteSuccess",()=>{p.value=!1,h.success(e("admin.images.deleteImageSuccess")),I()}),J.on("deleteError",i=>{p.value=!1,h.error(e("admin.images.deleteImageFailed")+`: ${O(i.code)})`),I()})}),Ee(()=>{J.disconnect()}),(i,t)=>{const d=b("a-input-search"),c=b("a-select-option"),j=b("a-select"),Ie=b("a-input"),x=b("a-button"),Oe=b("a-spin"),Ue=b("a-avatar"),ze=b("a-table"),f=b("a-descriptions-item"),Q=b("a-descriptions"),H=b("a-modal"),xe=b("a-form-item"),Pe=b("a-form");return y(),w("div",Le,[m("div",Je,[m("div",Ke,[m("div",qe,[s(d,{value:P.value,"onUpdate:value":t[0]||(t[0]=n=>P.value=n),placeholder:a(e)("admin.images.searchPlaceholder"),class:"search-input",onSearch:G},null,8,["value","placeholder"]),m("div",We,[s(j,{value:M.value,"onUpdate:value":t[1]||(t[1]=n=>M.value=n),class:"field-select",style:{width:"150px"},placeholder:a(e)("admin.images.selectField")},{default:l(()=>[s(c,{value:"storage_name"},{default:l(()=>[r(o(a(e)("admin.images.storageName")),1)]),_:1}),s(c,{value:"user_id"},{default:l(()=>[r(o(a(e)("admin.images.userId")),1)]),_:1}),s(c,{value:"album_id"},{default:l(()=>[r(o(a(e)("admin.images.albumId")),1)]),_:1})]),_:1},8,["value","placeholder"]),s(Ie,{value:F.value,"onUpdate:value":t[2]||(t[2]=n=>F.value=n),class:"field-value-input",placeholder:a(e)("admin.images.enterValue"),style:{width:"150px"},onPressEnter:G},null,8,["value","placeholder"]),s(x,{type:"primary",onClick:G,disabled:!M.value||!F.value},{default:l(()=>[r(o(a(e)("admin.images.applyFilter")),1)]),_:1},8,["disabled"])])]),m("div",Ge,[m("div",Qe,[m("span",Xe,o(a(e)("admin.images.sortLabel")),1),s(j,{value:N.value,"onUpdate:value":t[3]||(t[3]=n=>N.value=n),class:"sort-select",style:{width:"120px"},onChange:te},{default:l(()=>[s(c,{value:"created_at"},{default:l(()=>[r(o(a(e)("admin.images.sortOptions.createdAt")),1)]),_:1}),s(c,{value:"updated_at"},{default:l(()=>[r(o(a(e)("admin.images.sortOptions.updatedAt")),1)]),_:1}),s(c,{value:"file_size"},{default:l(()=>[r(o(a(e)("admin.images.sortOptions.fileSize")),1)]),_:1}),s(c,{value:"file_name"},{default:l(()=>[r(o(a(e)("admin.images.sortOptions.fileName")),1)]),_:1})]),_:1},8,["value"]),s(j,{value:R.value,"onUpdate:value":t[4]||(t[4]=n=>R.value=n),class:"sort-select",style:{width:"80px"},onChange:te},{default:l(()=>[s(c,{value:"desc"},{default:l(()=>[r(o(a(e)("admin.images.sortOptions.desc")),1)]),_:1}),s(c,{value:"asc"},{default:l(()=>[r(o(a(e)("admin.images.sortOptions.asc")),1)]),_:1})]),_:1},8,["value"])]),s(x,{type:"text",onClick:me},{default:l(()=>[r(o(a(e)("admin.images.resetFilters")),1)]),_:1})])]),g.value.length>0?(y(),w("div",Ye,[m("span",null,o(g.value.length)+" "+o(a(e)("admin.images.selectedCount")),1),s(x,{type:"primary",onClick:t[5]||(t[5]=n=>D.value=!0)},{default:l(()=>[r(o(a(e)("admin.images.batchUpdateStorage")),1)]),_:1}),s(x,{type:"primary",danger:"",onClick:pe},{default:l(()=>[s(a(ie)),r(" "+o(a(e)("admin.images.batchDelete")),1)]),_:1})])):q("",!0),p.value?(y(),w("div",Ze,[s(Oe,{size:"small"},{default:l(()=>[m("span",null,o(a(e)("admin.images.deleting")),1)]),_:1})])):q("",!0),s(ze,{columns:ce,"data-source":A.value,loading:v.value,pagination:_.value,onChange:ge,"row-key":"id","row-selection":{selectedRowKeys:g.value,onChange:ve,selections:[{key:"all-data",text:a(e)("admin.images.selectAll"),onSelect:()=>{g.value=A.value.map(n=>n.id)}},{key:"clear",text:a(e)("admin.images.clearSelection"),onSelect:()=>{g.value=[]}}]}},{image:l(({record:n})=>[s(Ue,{src:a(Ve)(n.thumbnail_url),alt:n.filename,size:"large"},null,8,["src","alt"])]),size:l(({record:n})=>[m("span",null,o(a(Fe)(n.file_size)),1)]),user_id:l(({record:n})=>[m("a",{onClick:C=>_e(n.user_id)},o(n.user_id),9,ea)]),albums:l(({record:n})=>[(y(!0),w(Y,null,Z(n.albums,(C,X)=>(y(),w("span",{key:C.id},[m("a",{onClick:da=>fe(C.id)},o(C.id),9,aa),X<n.albums.length-1?(y(),w("span",ta,", ")):q("",!0)]))),128))]),storage_name:l(({record:n})=>[m("a",{onClick:C=>he(n.storage_name)},o(n.storage_name),9,la)]),tags:l(({record:n})=>[(y(!0),w(Y,null,Z(n.tags,(C,X)=>(y(),w("span",{key:C.id},[r(o(C)+" ",1),X<n.tags.length-1?(y(),w("span",sa,", ")):q("",!0)]))),128))]),created_at:l(({record:n})=>[m("span",null,o(a(K)(n.created_at)),1)]),actions:l(({record:n})=>[s(x,{type:"text",size:"small",onClick:C=>Ce(n)},{default:l(()=>[s(a(ee))]),_:1},8,["onClick"]),s(x,{type:"text",size:"small",danger:"",onClick:C=>ke(n.id)},{default:l(()=>[s(a(ie))]),_:1},8,["onClick"])]),_:1},8,["data-source","loading","pagination","row-selection"])]),s(De,{visible:T.value,image:W.value,"onUpdate:visible":t[6]||(t[6]=n=>T.value=n),onClose:Se},null,8,["visible","image"]),s(H,{open:E.value,"onUpdate:open":t[7]||(t[7]=n=>E.value=n),title:a(e)("admin.images.userPreviewTitle"),width:"40%",onCancel:le,onOk:le},{default:l(()=>[s(Q,{column:1,bordered:"",size:"small"},{default:l(()=>[s(f,{label:a(e)("admin.images.userId")},{default:l(()=>[r(o(U.value.id),1)]),_:1},8,["label"]),s(f,{label:a(e)("admin.images.username")},{default:l(()=>[r(o(U.value.username),1)]),_:1},8,["label"]),s(f,{label:a(e)("admin.images.email")},{default:l(()=>[r(o(U.value.email),1)]),_:1},8,["label"]),s(f,{label:a(e)("admin.images.registerTime")},{default:l(()=>[r(o(a(K)(U.value.created_at)),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["open","title"]),s(H,{open:B.value,"onUpdate:open":t[8]||(t[8]=n=>B.value=n),title:a(e)("admin.images.albumPreviewTitle"),width:"40%",onCancel:se,onOk:se},{default:l(()=>[s(Q,{column:1,bordered:"",size:"small"},{default:l(()=>[s(f,{label:a(e)("admin.images.albumName")},{default:l(()=>[r(o(S.value.name),1)]),_:1},8,["label"]),s(f,{label:a(e)("admin.images.albumDescription")},{default:l(()=>[r(o(S.value.description||a(e)("admin.images.none")),1)]),_:1},8,["label"]),s(f,{label:a(e)("admin.images.createdAt")},{default:l(()=>[r(o(a(K)(S.value.created_at)),1)]),_:1},8,["label"]),s(f,{label:a(e)("admin.images.updatedAt")},{default:l(()=>[r(o(a(K)(S.value.updated_at)),1)]),_:1},8,["label"]),s(f,{label:a(e)("admin.images.coverImage")},{default:l(()=>[S.value.cover_image?(y(),w("a",{key:0,href:S.value.cover_image,target:"_blank"},o(a(e)("admin.images.view")),9,na)):(y(),w("span",oa,o(a(e)("admin.images.none")),1))]),_:1},8,["label"]),s(f,{label:a(e)("admin.images.imageCount")},{default:l(()=>[r(o(S.value.image_count)+" "+o(a(e)("admin.images.images")),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["open","title"]),s(H,{open:$.value,"onUpdate:open":t[9]||(t[9]=n=>$.value=n),title:a(e)("admin.images.storagePreviewTitle"),width:"40%",onCancel:ne,onOk:ne},{default:l(()=>[s(Q,{column:1,bordered:"",size:"small"},{default:l(()=>[s(f,{label:a(e)("storages.storageName")},{default:l(()=>[r(o(V.value.name),1)]),_:1},8,["label"]),s(f,{label:a(e)("storages.storageType")},{default:l(()=>[r(o(V.value.type),1)]),_:1},8,["label"]),s(f,{label:a(e)("storages.storageConfig")},{default:l(()=>[m("pre",null,o(JSON.stringify(V.value.config,null,2)),1)]),_:1},8,["label"])]),_:1})]),_:1},8,["open","title"]),s(H,{open:D.value,"onUpdate:open":t[11]||(t[11]=n=>D.value=n),title:a(e)("admin.images.batchUpdateStorageTitle"),width:"40%",onCancel:we,onOk:ye},{default:l(()=>[s(Pe,null,{default:l(()=>[s(xe,{label:a(e)("admin.images.storageName")},{default:l(()=>[s(j,{value:z.value.storage_name,"onUpdate:value":t[10]||(t[10]=n=>z.value.storage_name=n),placeholder:a(e)("admin.images.selectStoragePlaceholder"),style:{width:"100%"}},{default:l(()=>[(y(!0),w(Y,null,Z(ae.value,n=>(y(),Be(c,{key:n.name,value:n.name},{default:l(()=>[r(o(n.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"]),m("div",ia,o(a(e)("admin.images.updatingImages",{count:g.value.length})),1)]),_:1})]),_:1},8,["open","title"])])}}}),fa=$e(ra,[["__scopeId","data-v-dac951d2"]]);export{fa as default};
