import{u as C,a as q}from"./services-DL6wjq8D.js";import{d as B,C as D,D as I,j as M,c as A,a as t,l as n,y as i,t as l,i as s,x as E,k as L,E as U,f as _,H as T,J as h,I as m,z as j,o as k,_ as z}from"./index-DmJlHfzr.js";import{a as H}from"./index-FacjB4mQ.js";import{g as x}from"./errorMessages-Dl98_79z.js";import"./axios-Cl3Sb8ms.js";const J={class:"profile-container"},G={class:"profile-main card"},K={class:"profile-content"},O={class:"stats-grid"},Q={class:"stat-item"},W={class:"stat-label"},X={class:"stat-value"},Y={class:"stat-item"},Z={class:"stat-label"},$={class:"stat-value"},ee=B({__name:"ProfileView",setup(ae){const{t:e}=D(),w=I(),y=j(),u=_(!1),d=_(!1),v=_(),r=T({username:"",password:""}),c=_(null),F={username:[{required:!0,message:()=>e("profile.validation.usernameRequired"),trigger:"blur"},{min:3,max:20,message:()=>e("profile.validation.usernameLength"),trigger:"blur"}],email:[{required:!0,message:()=>e("profile.validation.emailRequired"),trigger:"blur"},{type:"email",message:()=>e("profile.validation.emailFormat"),trigger:"blur"}],password:[{min:6,message:()=>e("profile.validation.passwordLength"),trigger:"blur"}]},P=()=>{d.value=!d.value,d.value||(r.password="")},R=async()=>{try{u.value=!0;const o=await C.getCurrentUser();c.value=o.data,r.username=o.data.username}catch(o){const a=o.response?.data?.code,p=a?x(a):e("profile.fetchUserFailed");h.error(p)}finally{u.value=!1}},V=async()=>{if(v.value)try{await v.value.validate(),u.value=!0;const o={username:r.username};r.password&&(o.password=r.password),await C.updateCurrentUser(o),h.success(e("profile.updateSuccess"));try{await q.logout({refresh_token:localStorage.getItem("refresh_token")||""}),w.logout(),y.push("/login")}catch(a){console.error("Logout error:",a),w.logout(),y.push("/login")}}catch(o){const a=o.response?.data?.code,p=a?x(a):e("profile.updateFailed");h.error(p)}finally{u.value=!1}};return M(()=>{R()}),(o,a)=>{const p=m("a-input"),f=m("a-form-item"),N=m("a-input-password"),b=m("a-button"),S=m("a-form");return k(),A("div",J,[t("main",G,[t("div",K,[n(S,{model:r,rules:F,ref_key:"userFormRef",ref:v,onFinish:V,class:"profile-form"},{default:i(()=>[t("p",null,l(s(e)("profile.email"))+" "+l(c.value?.email),1),n(f,{name:"username",label:s(e)("profile.username")},{default:i(()=>[n(p,{value:r.username,"onUpdate:value":a[0]||(a[0]=g=>r.username=g),placeholder:s(e)("profile.enterUsername")},null,8,["value","placeholder"])]),_:1},8,["label"]),d.value?(k(),E(f,{key:0,name:"password",label:s(e)("profile.password")},{default:i(()=>[n(N,{value:r.password,"onUpdate:value":a[1]||(a[1]=g=>r.password=g),placeholder:s(e)("profile.enterNewPassword")},null,8,["value","placeholder"])]),_:1},8,["label"])):L("",!0),n(f,null,{default:i(()=>[n(b,{type:"text",onClick:P},{default:i(()=>[U(l(d.value?s(e)("profile.cancelPassword"):s(e)("profile.changePassword")),1)]),_:1})]),_:1}),n(f,null,{default:i(()=>[n(b,{type:"primary","html-type":"submit",loading:u.value},{default:i(()=>[U(l(s(e)("profile.saveChanges")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),t("div",O,[t("div",Q,[t("div",W,l(s(e)("profile.userRole")),1),t("div",X,l(c.value?.role.name)+" : "+l(c.value?.role.description),1)]),t("div",Y,[t("div",Z,l(s(e)("profile.registerTime")),1),t("div",$,l(s(H)(c.value?.created_at||"")),1)])])])])])}}}),ne=z(ee,[["__scopeId","data-v-ddd7fedc"]]);export{ne as default};
