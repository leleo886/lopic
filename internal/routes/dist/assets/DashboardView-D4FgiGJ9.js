import{l as Y,K as at,d as W,j as Z,L as ot,w as nt,c as D,a as s,T as ct,x as lt,n as it,t as u,k as ut,f as r,e as rt,o as E,_ as G,C as dt,i as f,M as ht}from"./index-DbrgNN6k.js";import{u as q,b as vt}from"./services-DL6wjq8D.js";import{f as ft}from"./index-FacjB4mQ.js";import{A as _t,C as gt}from"./CameraOutlined-CBIC7K_C.js";import"./axios-Cl3Sb8ms.js";var pt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M938 458.8l-29.6-312.6c-1.5-16.2-14.4-29-30.6-30.6L565.2 86h-.4c-3.2 0-5.7 1-7.6 2.9L88.9 557.2a9.96 9.96 0 000 14.1l363.8 363.8c1.9 1.9 4.4 2.9 7.1 2.9s5.2-1 7.1-2.9l468.3-468.3c2-2.1 3-5 2.8-8zM459.7 834.7L189.3 564.3 589 164.6 836 188l23.4 247-399.7 399.7zM680 256c-48.5 0-88 39.5-88 88s39.5 88 88 88 88-39.5 88-88-39.5-88-88-88zm0 120c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z"}}]},name:"tag",theme:"outlined"};function H(g){for(var o=1;o<arguments.length;o++){var n=arguments[o]!=null?Object(arguments[o]):{},p=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(n).filter(function(m){return Object.getOwnPropertyDescriptor(n,m).enumerable}))),p.forEach(function(m){mt(g,m,n[m])})}return g}function mt(g,o,n){return o in g?Object.defineProperty(g,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):g[o]=n,g}var I=function(o,n){var p=H({},o,n.attrs);return Y(at,H({},p,{icon:pt}),null)};I.displayName="TagOutlined";I.inheritAttrs=!1;const yt={class:"tooltip-content"},xt={class:"tooltip-tag"},bt={class:"tooltip-count"},wt={class:"controls-hint"},Mt={class:"hint-text"},zt={class:"hint-icons"},Tt={class:"hint-icon"},Ct={class:"hint-icon"},N=500,X=160,St=W({__name:"SphereTagCloud",props:{tags:{}},setup(g){const o=g,n=r(null),p=r(null),m=r(!1),y=r(!1),w=r(null),T=r(!1),$=()=>{T.value=window.innerWidth<768},d=r({x:0,y:0}),b=r({x:.003,y:.003}),C=r(1),S=r({x:0,y:0});let c=[],L=null;function U(){const t=o.tags.length;if(t===0)return;const e=Math.max(...o.tags.map(i=>i.count)),l=Math.min(...o.tags.map(i=>i.count));c=o.tags.map((i,_)=>{const h=Math.acos(-1+2*_/t),O=Math.sqrt(t*Math.PI)*h,A=Math.cos(O)*Math.sin(h),a=Math.sin(O)*Math.sin(h),x=Math.cos(h),v=14+(i.count-l)/(e-l||1)*18;return{x:A*X,y:a*X,z:x*X,tx:0,ty:0,tz:0,cx:0,cy:0,scale:1,alpha:1,blur:0,fontSize:v,element:i,baseHue:Math.random()*360}})}function F(){const t=p.value,e=t?.getContext("2d",{alpha:!0});if(!t||!e||!n.value)return;const l=n.value.getBoundingClientRect();t.width!==l.width&&(t.width=l.width,t.height=l.height);const{width:i,height:_}=t,h=i/2,O=_/2;if(e.clearRect(0,0,i,_),!y.value){const a=m.value?.001:.004;b.value.x+=(a-b.value.x)*.05,b.value.y+=(a-b.value.y)*.05,d.value.x+=b.value.x,d.value.y+=b.value.y}if(c.forEach(a=>{let x=a.y*Math.cos(d.value.x)-a.z*Math.sin(d.value.x),v=a.y*Math.sin(d.value.x)+a.z*Math.cos(d.value.x),M=a.x*Math.cos(d.value.y)-v*Math.sin(d.value.y),z=a.x*Math.sin(d.value.y)+v*Math.cos(d.value.y);a.tx=M,a.ty=x,a.tz=z;const V=N/(N+z*C.value);a.scale=V*C.value,a.cx=h+M*a.scale,a.cy=O+x*a.scale;const j=(z+X)/(2*X);a.alpha=1-j*.7,a.blur=j*1}),[...c].sort((a,x)=>a.tz-x.tz).forEach(a=>{e.save(),e.translate(a.cx,a.cy),a.blur>.5?e.filter=`blur(${a.blur.toFixed(1)}px)`:e.filter="none";const x=w.value===a,v=Math.max(3,a.fontSize*a.scale);e.font=`600 ${v}px "Segoe UI", Roboto, Helvetica, Arial, sans-serif`,e.textAlign="center",e.textBaseline="middle";const M=30+(1-a.alpha)*40;e.fillStyle=`hsla(${a.baseHue}, 60%, ${x?10:M}%, ${a.alpha})`;const z=x?1.2:1;e.scale(z,z),e.fillText(a.element.tag,0,0),e.restore()}),!y.value){let a=null;const x=[...c].sort((v,M)=>v.tz-M.tz);for(const v of x){const M=v.cx-S.value.x,z=v.cy-S.value.y;if(Math.sqrt(M*M+z*z)<v.fontSize*v.scale/2+5&&v.tz<50){a=v;break}}w.value=a}L=requestAnimationFrame(F)}const J=t=>{y.value=!0;let e=t.clientX,l=t.clientY;const i=h=>{const O=h.clientX-e,A=h.clientY-l;d.value.y+=O*.008,d.value.x-=A*.008,b.value={x:-A*.004,y:O*.004},e=h.clientX,l=h.clientY,P(h)},_=()=>{y.value=!1,window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",_)};window.addEventListener("mousemove",i),window.addEventListener("mouseup",_)},Q=t=>{t.preventDefault();const e=C.value*(t.deltaY>0?.95:1.05);e>.6&&e<2.5&&(C.value=e)};let R=0,B=0,k=0;const K=t=>{if(t.preventDefault(),y.value=!0,t.touches&&t.touches.length===1&&t.touches[0])R=t.touches[0].clientX,B=t.touches[0].clientY;else if(t.touches&&t.touches.length===2&&t.touches[0]&&t.touches[1]){const e=t.touches[0].clientX-t.touches[1].clientX,l=t.touches[0].clientY-t.touches[1].clientY;k=Math.sqrt(e*e+l*l)}},tt=t=>{if(t.preventDefault(),t.touches&&t.touches.length===1&&t.touches[0]){const e=t.touches[0],l=e.clientX-R,i=e.clientY-B;if(d.value.y+=l*.008,d.value.x-=i*.008,b.value={x:-i*.004,y:l*.004},R=e.clientX,B=e.clientY,n.value){const _=n.value.getBoundingClientRect();S.value={x:e.clientX-_.left,y:e.clientY-_.top}}}else if(t.touches&&t.touches.length===2&&t.touches[0]&&t.touches[1]){const e=t.touches[0].clientX-t.touches[1].clientX,l=t.touches[0].clientY-t.touches[1].clientY,i=Math.sqrt(e*e+l*l);if(k>0){const _=i/k,h=C.value*_;h>.6&&h<2.5&&(C.value=h)}k=i}},et=t=>{t.preventDefault(),y.value=!1,k=0},P=t=>{if(n.value){const e=n.value.getBoundingClientRect();S.value={x:t.clientX-e.left,y:t.clientY-e.top}}},st=rt(()=>({left:`${S.value.x+15}px`,top:`${S.value.y+15}px`}));return Z(()=>{U(),F(),$(),n.value?.addEventListener("mousemove",P),window.addEventListener("resize",$)}),ot(()=>{L&&cancelAnimationFrame(L),window.removeEventListener("resize",$)}),nt(()=>o.tags,U,{deep:!0}),(t,e)=>(E(),D("div",{ref_key:"containerRef",ref:n,class:"sphere-tag-cloud-container",onMousedown:J,onWheel:Q,onMouseenter:e[0]||(e[0]=l=>m.value=!0),onMouseleave:e[1]||(e[1]=l=>{m.value=!1,y.value=!1}),onTouchstart:K,onTouchmove:tt,onTouchend:et},[e[2]||(e[2]=s("div",{class:"background-effect"},[s("div",{class:"background-glow"}),s("div",{class:"background-grid"})],-1)),s("canvas",{ref_key:"canvasRef",ref:p,class:"tag-canvas"},null,512),Y(ct,{name:"fade"},{default:lt(()=>[w.value&&!y.value?(E(),D("div",{key:0,class:"tag-tooltip",style:it(st.value)},[s("div",yt,[s("div",xt,u(w.value.element.tag),1),s("div",bt,u(w.value.element.count),1)])],4)):ut("",!0)]),_:1}),s("div",wt,[s("span",Mt,u(T.value?"è§¦æ‘¸æ—‹è½¬ / åŒæŒ‡ç¼©æ”¾":"æ‹–æ‹½æ—‹è½¬ / æ»šè½®ç¼©æ”¾"),1),s("div",zt,[s("span",Tt,u(T.value?"ðŸ‘†":"ðŸ–±ï¸"),1),s("span",Ct,u((T.value,"ðŸ”")),1)])])],544))}}),$t=G(St,[["__scopeId","data-v-fcf648e8"]]),Ot={class:"dashboard-container"},Yt={class:"welcome-card card"},kt={class:"card-title"},At={class:"stats-grid"},Xt={class:"stat-card card"},Dt={class:"stat-icon"},Et={class:"stat-content"},Lt={class:"stat-title"},Rt={class:"stat-value"},Bt={class:"stat-card card"},It={class:"stat-icon"},Ut={class:"stat-content"},Ft={class:"stat-title"},Pt={class:"stat-value"},Vt={class:"stat-card card"},jt={class:"stat-icon"},qt={class:"stat-content"},Ht={class:"stat-title"},Nt={class:"stat-value"},Wt={class:"stat-card card"},Zt={class:"stat-icon"},Gt={class:"stat-content"},Jt={class:"stat-title"},Qt={class:"stat-value"},Kt={class:"tag-cloud-card card"},te={class:"card-title"},ee={class:"tag-cloud-container"},se={key:0,class:"tag-cloud-wrapper"},ae={key:1,class:"tag-cloud-empty"},oe=W({__name:"DashboardView",setup(g){const{t:o}=dt(),n=r(null),p=r(0),m=r(0),y=r(0),w=r(0),T=r(0),$=r([]),d=async()=>{try{const c=await q.getCurrentUser();c.data&&(n.value=c.data||null,n.value&&(m.value=n.value.image_count||0,y.value=n.value.total_size||0,w.value=n.value.role?.max_storage_size_mb||0,T.value=n.value.role?.max_albums_per_user||0))}catch(c){console.error("Failed to fetch user info:",c)}},b=async()=>{try{const c=await vt.getUserAlbums({page:1,page_size:1});p.value=c.data.total}catch(c){console.error("Failed to fetch stats:",c)}},C=async()=>{try{const c=await q.getCurrentUserTagsCloud();$.value=c.data||[]}catch(c){console.error("Failed to fetch tag cloud:",c)}},S=c=>{console.log("Clicked tag:",c.tag)};return Z(async()=>{await d(),await b(),await C()}),(c,L)=>(E(),D("div",Ot,[s("div",Yt,[s("h2",kt,u(f(o)("dashboard.welcome"))+"ï¼Œ"+u(n.value?.username)+"ï¼",1)]),s("div",At,[s("div",Xt,[s("div",Dt,[Y(f(_t))]),s("div",Et,[s("h3",Lt,u(f(o)("dashboard.myAlbums")),1),s("p",Rt,u(p.value)+" / "+u(T.value==-1?f(o)("dashboard.unlimited"):T.value),1)])]),s("div",Bt,[s("div",It,[Y(f(gt))]),s("div",Ut,[s("h3",Ft,u(f(o)("dashboard.myImages")),1),s("p",Pt,u(m.value),1)])]),s("div",Vt,[s("div",jt,[Y(f(I))]),s("div",qt,[s("h3",Ht,u(f(o)("dashboard.usedStorage")),1),s("p",Nt,u(f(ft)(y.value)),1)])]),s("div",Wt,[s("div",Zt,[Y(f(ht))]),s("div",Gt,[s("h3",Jt,u(f(o)("dashboard.storageSpace")),1),s("p",Qt,u(w.value==-1?f(o)("dashboard.unlimited"):w.value+" MB"),1)])])]),s("div",Kt,[s("h3",te,u(f(o)("dashboard.myTags")),1),s("div",ee,[$.value.length>0?(E(),D("div",se,[Y($t,{tags:$.value,onTagClick:S},null,8,["tags"])])):(E(),D("div",ae,[s("p",null,u(f(o)("dashboard.noTags")),1)]))])])]))}}),re=G(oe,[["__scopeId","data-v-8bfd553b"]]);export{re as default};
