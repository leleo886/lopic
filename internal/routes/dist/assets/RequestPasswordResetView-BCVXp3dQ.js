import{d as $,C as j,f as p,c as A,a as l,l as a,x as o,E as f,t as _,i as t,G as x,z as D,H as G,J as m,I as n,o as H,_ as J}from"./index-QwL2gIV2.js";import{a as z}from"./services-DL6wjq8D.js";import{g as F}from"./errorMessages-CmCcllaB.js";import"./axios-Cl3Sb8ms.js";const K={class:"login-container"},O={class:"login-card"},Q={class:"login-header"},W={class:"language-selector"},X={class:"login-title"},Y={class:"login-subtitle"},Z={class:"login-body"},ee={class:"login-footer"},se=$({__name:"RequestPasswordResetView",setup(ae){const{t:s}=j(),k=x("currentLanguage",p("zh")),L=x("changeLanguage",i=>{}),w=p(k.value),E=i=>{const e=i.target.value;w.value=e,L(e)},C=D(),P=p(),b=p(!1),h=p(!1),u=p(0);let c=null;const r=G({email:"",code:"",new_password:""}),I={email:[{required:!0,message:()=>s("resetPassword.validation.emailRequired"),trigger:"blur"},{type:"email",message:()=>s("resetPassword.validation.emailFormat"),trigger:"blur"}],code:[{required:!0,message:()=>s("resetPassword.validation.codeRequired"),trigger:"blur"}],new_password:[{required:!0,message:()=>s("resetPassword.validation.passwordRequired"),trigger:"blur"},{min:6,message:()=>s("resetPassword.validation.passwordLength"),trigger:"blur"}]},V=async()=>{if(!r.email){m.error(s("resetPassword.enterEmailFirst"));return}try{h.value=!0,await z.requestPasswordReset({email:r.email,locale:w.value}),m.success(s("resetPassword.codeSent")),N()}catch(i){const e=i.response?.data?.code,g=e?F(e):s("resetPassword.sendCodeFailed");m.error(g)}finally{h.value=!1}},N=()=>{u.value=60,c&&clearInterval(c),c=window.setInterval(()=>{u.value--,u.value<=0&&c&&(clearInterval(c),c=null)},1e3)},S=async()=>{if(P.value)try{await P.value.validate(),b.value=!0,await z.resetPassword(r),m.success(s("resetPassword.resetSuccess")),C.push("/login")}catch(i){const e=i.response?.data?.code,g=e?F(e):s("resetPassword.resetFailed");m.error(g)}finally{b.value=!1}};return(i,e)=>{const g=n("a-radio-button"),U=n("a-radio-group"),y=n("a-input"),v=n("a-form-item"),R=n("a-col"),q=n("a-button"),B=n("a-row"),M=n("a-input-password"),T=n("a-form");return H(),A("div",K,[l("div",O,[l("div",Q,[l("div",W,[a(U,{value:w.value,"onUpdate:value":e[0]||(e[0]=d=>w.value=d),onChange:E},{default:o(()=>[a(g,{value:"zh"},{default:o(()=>[...e[5]||(e[5]=[f("中文",-1)])]),_:1}),a(g,{value:"en"},{default:o(()=>[...e[6]||(e[6]=[f("English",-1)])]),_:1})]),_:1},8,["value"])]),l("h1",X,_(t(s)("login.title")),1),l("p",Y,_(t(s)("resetPassword.subtitle")),1)]),l("div",Z,[a(T,{model:r,rules:I,ref_key:"resetFormRef",ref:P,onFinish:S},{default:o(()=>[a(v,{name:"email",label:t(s)("resetPassword.email")},{default:o(()=>[a(y,{value:r.email,"onUpdate:value":e[1]||(e[1]=d=>r.email=d),placeholder:t(s)("resetPassword.enterEmail"),size:"large","prefix-icon":"mail"},null,8,["value","placeholder"])]),_:1},8,["label"]),a(v,{name:"code",label:t(s)("resetPassword.code")},{default:o(()=>[a(B,{gutter:12},{default:o(()=>[a(R,{span:14},{default:o(()=>[a(y,{value:r.code,"onUpdate:value":e[2]||(e[2]=d=>r.code=d),placeholder:t(s)("resetPassword.enterCode"),size:"large","prefix-icon":"verification"},null,8,["value","placeholder"])]),_:1}),a(R,{span:10},{default:o(()=>[a(q,{type:"default",size:"large",loading:h.value,disabled:u.value>0,onClick:V,class:"send-code-button"},{default:o(()=>[f(_(u.value>0?`${u.value}s`:t(s)("resetPassword.sendCode")),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["label"]),a(v,{name:"new_password",label:t(s)("resetPassword.newPassword")},{default:o(()=>[a(M,{value:r.new_password,"onUpdate:value":e[3]||(e[3]=d=>r.new_password=d),placeholder:t(s)("resetPassword.enterNewPassword"),size:"large","prefix-icon":"lock",visibilityToggle:""},null,8,["value","placeholder"])]),_:1},8,["label"]),a(v,null,{default:o(()=>[a(q,{type:"primary","html-type":"submit",class:"login-button",size:"large",loading:b.value},{default:o(()=>[f(_(t(s)("resetPassword.resetPassword")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"]),l("div",ee,[l("span",null,_(t(s)("resetPassword.rememberPassword")),1),l("a",{onClick:e[4]||(e[4]=d=>t(C).push("/login")),class:"login-link"},_(t(s)("resetPassword.login")),1)])])])])}}}),ne=J(se,[["__scopeId","data-v-93d477ee"]]);export{ne as default};
