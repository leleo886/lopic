import{c as g}from"./services-DL6wjq8D.js";import{g as _}from"./errorMessages-Bb-gZ73b.js";import{a as x,f as G}from"./index-FacjB4mQ.js";import{d as le,C as de,w as ue,j as pe,c as T,a as f,t as r,i as o,l,x as n,E as i,F as Q,s as A,k as D,H as ke,f as p,J as u,U as I,I as b,o as y,_ as me}from"./index-DbrgNN6k.js";import"./axios-Cl3Sb8ms.js";const be={class:"backup-view"},_e={class:"backup-content card"},fe={class:"backup-header"},ye={class:"backup-title"},ge={class:"backup-actions"},ve={class:"tab-content"},he={key:0,class:"empty-state"},Ce={class:"tab-content"},we=["onClick"],Be={key:0,class:"empty-state"},Re=le({__name:"BackupView",setup(xe){const{t:e}=de(),k=ke({backups:!1,restores:!1}),P=p(!1),$=p(null),E=p(null),O=p(null),F=p(!1),U=p(!1),V=p("backups"),h=p([]),C=p([]),M=p(!1),m=p({id:0,status:"",size:0,created_at:"",updated_at:"",start_time:"",end_time:"",error:"",storage_path:""}),W=[{title:"ID",dataIndex:"id",key:"id",width:80},{title:e("admin.backup.status"),dataIndex:"status",key:"status"},{title:e("admin.backup.backupSize"),dataIndex:"size",key:"size",slots:{customRender:"size"}},{title:e("admin.backup.backupFile"),dataIndex:"storage_path",key:"storage_path"},{title:e("admin.backup.startTime"),dataIndex:"start_time",key:"start_time",slots:{customRender:"start_time"}},{title:e("admin.backup.endTime"),dataIndex:"end_time",key:"end_time",slots:{customRender:"end_time"}},{title:e("admin.backup.errorMessage"),dataIndex:"error",key:"error",slots:{customRender:"error"}},{title:e("admin.backup.actions"),key:"actions"}],X=[{title:"ID",dataIndex:"id",key:"id",width:80},{title:e("admin.backup.restoreSource"),dataIndex:"backup_task_id",key:"backup_task_id"},{title:e("admin.backup.status"),dataIndex:"status",key:"status"},{title:e("admin.backup.startTime"),dataIndex:"start_time",key:"start_time",slots:{customRender:"start_time"}},{title:e("admin.backup.endTime"),dataIndex:"end_time",key:"end_time",slots:{customRender:"end_time"}},{title:e("admin.backup.errorMessage"),dataIndex:"error",key:"error",slots:{customRender:"error"}},{title:e("admin.backup.actions"),key:"actions",fixed:"right"}],L=p(null),K=a=>{switch(a){case"completed":return"green";case"failed":return"red";case"pending":case"running":return"blue";default:return"default"}},N=a=>{switch(a){case"completed":return e("admin.backup.statusCompleted");case"failed":return e("admin.backup.statusFailed");case"pending":return e("admin.backup.statusPending");case"running":return e("admin.backup.statusRunning");default:return a}},w=async()=>{try{k.backups=!0;const a=await g.getBackups();a.data&&Array.isArray(a.data)?h.value=a.data:a.data&&a.data.data&&Array.isArray(a.data.data)?h.value=a.data.data:h.value=[]}catch(a){const c=a.response?.data?.code,s=c?_(c):e("admin.backup.fetchBackupsFailed");u.error(s)}finally{k.backups=!1}},S=async()=>{try{k.restores=!0;const a=await g.getRestoreTasks();a.data&&Array.isArray(a.data)?C.value=a.data:a.data&&a.data.data&&Array.isArray(a.data.data)?C.value=a.data.data:C.value=[]}catch(a){const c=a.response?.data?.code,s=c?_(c):e("admin.backup.fetchRestoresFailed");u.error(s)}finally{k.restores=!1}},Y=async()=>{I.confirm({title:e("admin.backup.confirmCreateTitle"),content:e("admin.backup.confirmCreateContent"),okText:e("admin.backup.confirmCreate"),cancelText:e("admin.backup.cancel"),onOk:async()=>{try{P.value=!0,await g.createBackup(),u.success(e("admin.backup.createBackupStarted")),w()}catch(a){const c=a.response?.data?.code,s=c?_(c):e("admin.backup.createBackupFailed");u.error(s)}finally{P.value=!1}}})},Z=a=>{I.confirm({title:e("admin.backup.confirmRestoreTitle"),content:e("admin.backup.confirmRestoreContent",{id:a}),okText:e("admin.backup.confirmRestore"),okType:"danger",cancelText:e("admin.backup.cancel"),onOk:async()=>{try{$.value=a,await g.restoreBackup(a),u.success(e("admin.backup.restoreStarted")),S()}catch(c){const s=c.response?.data?.code,d=s?_(s):e("admin.backup.restoreBackupFailed");u.error(d)}finally{$.value=null}}})},ee=a=>{I.confirm({title:e("admin.backup.confirmDeleteTitle"),content:e("admin.backup.confirmDeleteContent",{id:a}),okText:e("admin.backup.confirmDelete"),okType:"danger",cancelText:e("admin.backup.cancel"),onOk:async()=>{try{E.value=a,await g.deleteBackup(a),u.success(e("admin.backup.deleteBackupSuccess")),w()}catch(c){const s=c.response?.data?.code,d=s?_(s):e("admin.backup.deleteBackupFailed");u.error(d)}finally{E.value=null}}})},ae=async a=>{try{O.value=a;const c=await g.downloadBackup(a),s=window.URL.createObjectURL(new Blob([c.data])),d=document.createElement("a");d.href=s;const B=new Date().getTime();d.setAttribute("download",`backup_${a}_${B}.zip`),document.body.appendChild(d),d.click(),document.body.removeChild(d),u.success(e("admin.backup.downloadBackupSuccess"))}catch(c){const s=c.response?.data?.code,d=s?_(s):e("admin.backup.downloadBackupFailed");u.error(d)}finally{O.value=null}},te=async a=>{const{file:c}=a;try{F.value=!0;const s=new FormData;s.append("file",c);const d=await g.uploadBackup(s);u.success(e("admin.backup.uploadBackupSuccess")),w(),a.onSuccess&&a.onSuccess(d)}catch(s){const d=s.response?.data?.code,B=d?_(d):e("admin.backup.uploadBackupFailed");u.error(B),a.onError&&a.onError(s)}finally{F.value=!1}},se=async()=>{try{U.value=!0,await Promise.all([w(),S()]),u.success(e("admin.backup.refreshSuccess"))}catch(a){const c=a.response?.data?.code,s=c?_(c):e("admin.backup.refreshFailed");u.error(s)}finally{U.value=!1}},ne=a=>{I.confirm({title:e("admin.backup.confirmDeleteTitle"),content:e("admin.backup.confirmDeleteRestoreContent",{id:a}),okText:e("admin.backup.confirmDelete"),okType:"danger",cancelText:e("admin.backup.cancel"),onOk:async()=>{try{L.value=a,await g.deleteRestoreTask(a),u.success(e("admin.backup.deleteRestoreSuccess")),S()}catch(c){const s=c.response?.data?.code,d=s?_(s):e("admin.backup.deleteRestoreFailed");u.error(d)}finally{L.value=null}}})},oe=a=>{a&&(m.value=a,M.value=!0)},j=()=>{M.value=!1,m.value={id:0,status:"",size:0,created_at:"",updated_at:"",start_time:"",end_time:"",error:"",storage_path:""}};return ue(V,a=>{a==="backups"&&h.value.length===0?w():a==="restores"&&C.value.length===0&&S()}),pe(()=>{w()}),(a,c)=>{const s=b("a-button"),d=b("a-upload"),B=b("a-tag"),q=b("a-table"),H=b("a-spin"),J=b("a-tab-pane"),ce=b("a-tabs"),v=b("a-descriptions-item"),re=b("a-descriptions"),ie=b("a-modal");return y(),T(Q,null,[f("div",be,[f("div",_e,[f("div",fe,[f("h2",ye,r(o(e)("admin.backup.title")),1),f("div",ge,[l(s,{type:"primary",onClick:Y,loading:P.value,class:"create-backup-button"},{default:n(()=>[i(r(o(e)("admin.backup.createBackup")),1)]),_:1},8,["loading"]),l(d,{"custom-request":te,"show-upload-list":!1,accept:".zip",disabled:F.value},{default:n(()=>[l(s,{type:"default",loading:F.value,class:"upload-backup-button"},{default:n(()=>[i(r(o(e)("admin.backup.uploadBackup")),1)]),_:1},8,["loading"])]),_:1},8,["disabled"]),l(s,{type:"default",onClick:se,loading:U.value,class:"refresh-backup-button"},{default:n(()=>[i(r(o(e)("admin.backup.refresh")),1)]),_:1},8,["loading"])])]),l(ce,{activeKey:V.value,"onUpdate:activeKey":c[0]||(c[0]=t=>V.value=t),type:"card",size:"large"},{default:n(()=>[l(J,{key:"backups",tab:o(e)("admin.backup.backupRecords")},{default:n(()=>[f("div",ve,[l(H,{spinning:k.backups,tip:o(e)("admin.backup.loadingBackups")},{default:n(()=>[l(q,{columns:W,"data-source":h.value,"row-key":t=>t.id,pagination:!1,loading:k.backups},{size:n(({record:t})=>[i(r(o(G)(t.size)),1)]),start_time:n(({record:t})=>[i(r(o(x)(t.start_time)),1)]),end_time:n(({record:t})=>[i(r(o(x)(t.end_time)),1)]),error:n(({record:t})=>[i(r(t.error||o(e)("admin.backup.none")),1)]),bodyCell:n(({record:t,column:R})=>[R.key==="actions"?(y(),T(Q,{key:0},[l(s,{type:"link",onClick:z=>ae(t.id),loading:O.value===t.id},{default:n(()=>[i(r(o(e)("admin.backup.download")),1)]),_:1},8,["onClick","loading"]),l(s,{type:"link",onClick:z=>Z(t.id),loading:$.value===t.id},{default:n(()=>[i(r(o(e)("admin.backup.restore")),1)]),_:1},8,["onClick","loading"]),l(s,{type:"link",danger:"",onClick:z=>ee(t.id),loading:E.value===t.id},{default:n(()=>[i(r(o(e)("admin.backup.delete")),1)]),_:1},8,["onClick","loading"])],64)):R.key==="status"?(y(),A(B,{key:1,color:K(t.status)},{default:n(()=>[i(r(N(t.status)),1)]),_:2},1032,["color"])):D("",!0)]),_:1},8,["data-source","row-key","loading"]),h.value.length===0&&!k.backups?(y(),T("div",he,[f("p",null,r(o(e)("admin.backup.noBackupRecords")),1)])):D("",!0)]),_:1},8,["spinning","tip"])])]),_:1},8,["tab"]),l(J,{key:"restores",tab:o(e)("admin.backup.restoreRecords")},{default:n(()=>[f("div",Ce,[l(H,{spinning:k.restores,tip:o(e)("admin.backup.loadingRestores")},{default:n(()=>[l(q,{columns:X,"data-source":C.value,"row-key":t=>t.id,pagination:!1,loading:k.restores},{start_time:n(({record:t})=>[i(r(o(x)(t.start_time)),1)]),end_time:n(({record:t})=>[i(r(o(x)(t.end_time)),1)]),error:n(({record:t})=>[i(r(t.error||o(e)("admin.backup.none")),1)]),bodyCell:n(({record:t,column:R})=>[R.key==="status"?(y(),A(B,{key:0,color:K(t.status)},{default:n(()=>[i(r(N(t.status)),1)]),_:2},1032,["color"])):R.key==="backup_task_id"?(y(),T("a",{key:1,onClick:z=>oe(t.backup_task)},r(t.backup_task_id),9,we)):R.key==="actions"?(y(),A(s,{key:2,type:"link",danger:"",onClick:z=>ne(t.id),loading:L.value===t.id},{default:n(()=>[i(r(o(e)("admin.backup.delete")),1)]),_:1},8,["onClick","loading"])):D("",!0)]),_:1},8,["data-source","row-key","loading"]),C.value.length===0&&!k.restores?(y(),T("div",Be,[f("p",null,r(o(e)("admin.backup.noRestoreRecords")),1)])):D("",!0)]),_:1},8,["spinning","tip"])])]),_:1},8,["tab"])]),_:1},8,["activeKey"])])]),l(ie,{open:M.value,"onUpdate:open":c[1]||(c[1]=t=>M.value=t),title:o(e)("admin.backup.backupFile"),width:"50%",onCancel:j,onOk:j},{default:n(()=>[l(re,{column:1,bordered:"",size:"small"},{default:n(()=>[l(v,{label:o(e)("admin.backup.backupId")},{default:n(()=>[i(r(m.value.id),1)]),_:1},8,["label"]),l(v,{label:o(e)("admin.backup.status")},{default:n(()=>[i(r(N(m.value.status)),1)]),_:1},8,["label"]),l(v,{label:o(e)("admin.backup.backupSize")},{default:n(()=>[i(r(o(G)(m.value.size)),1)]),_:1},8,["label"]),l(v,{label:o(e)("admin.backup.storagePath")},{default:n(()=>[i(r(m.value.storage_path),1)]),_:1},8,["label"]),l(v,{label:o(e)("admin.backup.startTime")},{default:n(()=>[i(r(o(x)(m.value.start_time)),1)]),_:1},8,["label"]),l(v,{label:o(e)("admin.backup.endTime")},{default:n(()=>[i(r(o(x)(m.value.end_time)),1)]),_:1},8,["label"]),m.value.error?(y(),A(v,{key:0,label:o(e)("admin.backup.errorMessage")},{default:n(()=>[i(r(m.value.error),1)]),_:1},8,["label"])):D("",!0)]),_:1})]),_:1},8,["open","title"])],64)}}}),ze=me(Re,[["__scopeId","data-v-a42a2b96"]]);export{ze as default};
