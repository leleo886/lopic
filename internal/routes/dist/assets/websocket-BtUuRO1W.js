import"./axios-Cl3Sb8ms.js";class o{ws=null;url;token;listeners;constructor(){this.token=localStorage.getItem("access_token")||"";const e=window.location.protocol==="https:"?"wss:":"ws:";this.url=`${e}//${window.location.host}/ws/upload?token=Bearer ${this.token}`,this.listeners={start:[],progress:[],complete:[],error:[],processingStart:[],processingError:[],processingComplete:[],deleteSuccess:[],deleteError:[],deleteUserSuccess:[],deleteUserError:[],open:[],close:[],wsError:[]}}connect(){try{this.ws=new WebSocket(this.url),this.ws.onopen=()=>{this.listeners.open.forEach(e=>e())},this.ws.onmessage=e=>{try{const s=JSON.parse(e.data);this.handleMessage(s)}catch(s){console.error("Error parsing WebSocket message:",s)}},this.ws.onclose=()=>{this.listeners.close.forEach(e=>e())},this.ws.onerror=e=>{this.listeners.wsError.forEach(s=>s(e))}}catch(e){console.error("Error connecting to WebSocket:",e)}}disconnect(){this.ws&&(this.ws.close(),this.ws=null)}handleMessage(e){switch(e.type){case"upload_start":this.listeners.start.forEach(s=>s(e.payload));break;case"upload_progress":this.listeners.progress.forEach(s=>s(e.payload));break;case"upload_error":this.listeners.error.forEach(s=>s(e.payload));break;case"upload_complete":this.listeners.complete.forEach(s=>s(e.payload));break;case"upload_processing_start":this.listeners.processingStart.forEach(s=>s(e.payload));break;case"upload_processing_error":this.listeners.processingError.forEach(s=>s(e.payload));break;case"upload_processing_complete":this.listeners.processingComplete.forEach(s=>s(e.payload));break;case"delete_success":this.listeners.deleteSuccess.forEach(s=>s(e.payload));break;case"delete_exist_error":this.listeners.deleteError.forEach(s=>s(e.payload));break;case"delete_user_success":this.listeners.deleteUserSuccess.forEach(s=>s(e.payload));break;case"delete_user_error":this.listeners.deleteUserError.forEach(s=>s(e.payload));break;default:console.log("Unknown message type:",e)}}on(e,s){e in this.listeners&&this.listeners[e].push(s)}off(e,s){if(e in this.listeners){const r=this.listeners[e].indexOf(s);r>-1&&this.listeners[e].splice(r,1)}}isConnected(){return this.ws?.readyState===WebSocket.OPEN}}const a=new o;export{a as u};
