import{l as s,K as E,d as ee,C as te,D as ae,j as le,c as v,a as u,y as m,E as w,t as p,i as l,P as F,N as se,F as ne,r as re,O as oe,f as g,H as ie,J as h,I as f,z as ce,o as y,Q as ue,s as L,R as me,U as de,_ as pe}from"./index-DmJlHfzr.js";import{b as T,u as be}from"./services-DL6wjq8D.js";import{a as fe}from"./index-FacjB4mQ.js";import{g as S}from"./errorMessages-Dl98_79z.js";import{A as _e,C as ve}from"./CameraOutlined-DLqVI4kP.js";import"./axios-Cl3Sb8ms.js";var ge={icon:function(e,n){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:e}},{tag:"path",attrs:{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm193.4 225.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.3 0 19.9 5 25.9 13.3l71.2 98.8 157.2-218c6-8.4 15.7-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.4 12.7z",fill:n}},{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z",fill:e}}]}},name:"check-circle",theme:"twotone"};function $(o){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},d=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(n).filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable}))),d.forEach(function(c){he(o,c,n[c])})}return o}function he(o,e,n){return e in o?Object.defineProperty(o,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[e]=n,o}var z=function(e,n){var d=$({},e,n.attrs);return s(E,$({},d,{icon:ge}),null)};z.displayName="CheckCircleTwoTone";z.inheritAttrs=!1;var ye={icon:function(e,n){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z",fill:e}},{tag:"path",attrs:{d:"M512 140c-205.4 0-372 166.6-372 372s166.6 372 372 372 372-166.6 372-372-166.6-372-372-372zm171.8 527.1c1.2 1.5 1.9 3.3 1.9 5.2 0 4.5-3.6 8-8 8l-66-.3-99.3-118.4-99.3 118.5-66.1.3c-4.4 0-8-3.6-8-8 0-1.9.7-3.7 1.9-5.2L471 512.3l-130.1-155a8.32 8.32 0 01-1.9-5.2c0-4.5 3.6-8 8-8l66.1.3 99.3 118.4 99.4-118.5 66-.3c4.4 0 8 3.6 8 8 0 1.9-.6 3.8-1.8 5.2l-130.1 155 129.9 154.9z",fill:n}},{tag:"path",attrs:{d:"M685.8 352c0-4.4-3.6-8-8-8l-66 .3-99.4 118.5-99.3-118.4-66.1-.3c-4.4 0-8 3.5-8 8 0 1.9.7 3.7 1.9 5.2l130.1 155-130.1 154.9a8.32 8.32 0 00-1.9 5.2c0 4.4 3.6 8 8 8l66.1-.3 99.3-118.5L611.7 680l66 .3c4.4 0 8-3.5 8-8 0-1.9-.7-3.7-1.9-5.2L553.9 512.2l130.1-155c1.2-1.4 1.8-3.3 1.8-5.2z",fill:e}}]}},name:"close-circle",theme:"twotone"};function j(o){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?Object(arguments[e]):{},d=Object.keys(n);typeof Object.getOwnPropertySymbols=="function"&&(d=d.concat(Object.getOwnPropertySymbols(n).filter(function(c){return Object.getOwnPropertyDescriptor(n,c).enumerable}))),d.forEach(function(c){Ce(o,c,n[c])})}return o}function Ce(o,e,n){return e in o?Object.defineProperty(o,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):o[e]=n,o}var M=function(e,n){var d=j({},e,n.attrs);return s(E,j({},d,{icon:ye}),null)};M.displayName="CloseCircleTwoTone";M.inheritAttrs=!1;const we={class:"albums-container"},Ae={class:"albums-header card"},Oe={class:"albums-main"},ke={key:0,class:"albums-grid"},Te=["onClick"],xe={class:"album-cover"},Se={class:"cover-text"},ze={class:"album-info"},Me={class:"album-title"},Pe={class:"album-description"},De={class:"album-meta"},Ne={class:"album-date"},Ue={class:"album-images"},Fe={class:"album-actions"},Le={style:{width:"100%"}},$e={key:0},je={key:1},Ee={key:1,class:"empty-state"},Ie={class:"empty-icon"},Re={class:"empty-title"},Be={class:"empty-description"},Ve=ee({__name:"AlbumsView",setup(o){const{t:e}=te(),n=ae(),d=ce(),c=g([]),P=g(null),D=g(!1),C=g(!1),O=g(!1),A=g(),_=g(null),i=ie({name:"",description:"",gallery_enabled:!1,serial_number:0}),I={name:[{required:!0,message:()=>e("albums.enterAlbumName"),trigger:"blur"},{max:100,message:()=>e("albums.albumNameLimit"),trigger:"blur"}],description:[{max:500,message:()=>e("albums.albumDescriptionLimit"),trigger:"blur"}]},R=async()=>{try{const a=await be.getCurrentUser();a.data&&(P.value=a.data||null)}catch(a){console.error("Failed to fetch user info:",a)}},B=()=>{const a=n.user?.username;d.push(`/gallery/${a}`)},V=async()=>{try{D.value=!0;const a=await T.getUserAlbums({page:1,page_size:100});c.value=a.data.albums}catch(a){const t=a.response?.data?.code,b=t?S(t):e("albums.fetchAlbumsFailed");h.error(b)}finally{D.value=!1}},H=a=>{d.push(`/manage/album/${a}`)},G=a=>{_.value=a,i.name=a.name,i.description=a.description,i.gallery_enabled=a.gallery_enabled,i.serial_number=a.serial_number||0,C.value=!0},q=async()=>{if(A.value){if(O.value=!0,await R(),!P.value?.role.gallery_open&&i.gallery_enabled){h.error(e("albums.galleryPermissionDenied")),O.value=!1;return}try{if(await A.value.validate(),_.value){await T.updateUserAlbum(_.value.id,i),h.success(e("albums.updateSuccess"));const a=c.value.findIndex(t=>t.id===_.value?.id);if(a!==-1){const t=c.value[a];t&&(c.value[a]={...t,...i,id:_.value.id,user_id:t.user_id,created_at:t.created_at,updated_at:t.updated_at})}}else{const a=await T.createAlbum(i);h.success(e("albums.createSuccess")),c.value.unshift({...a.data,image_count:0})}N()}catch(a){const t=a.response?.data?.code,b=t?S(t):e("albums.saveFailed");h.error(b)}finally{O.value=!1}}},J=a=>{de.confirm({title:e("albums.confirmDelete"),content:e("albums.deleteConfirmContent"),onOk:async()=>{try{await T.deleteUserAlbum(a),h.success(e("albums.deleteSuccess")),c.value=c.value.filter(t=>t.id!==a)}catch(t){const b=t.response?.data?.code,x=b?S(b):e("albums.deleteFailed");h.error(x)}}})},N=()=>{C.value=!1,_.value=null,i.name="",i.description="",i.gallery_enabled=!1,A.value&&A.value.resetFields()};return le(()=>{V()}),(a,t)=>{const b=f("a-button"),x=f("a-input-number"),k=f("a-form-item"),Q=f("a-input"),W=f("a-textarea"),X=f("a-switch"),Y=f("a-tooltip"),Z=f("a-form"),K=f("a-modal");return y(),v("div",we,[u("header",Ae,[s(b,{type:"primary",onClick:t[0]||(t[0]=r=>C.value=!0),class:"create-button"},{icon:m(()=>[s(l(F))]),default:m(()=>[w(" "+p(l(e)("albums.createAlbum")),1)]),_:1}),s(b,{type:"primary",onClick:B,class:"create-button"},{icon:m(()=>[s(l(se))]),default:m(()=>[w(" "+p(l(e)("albums.openGallery")),1)]),_:1})]),u("main",Oe,[c.value.length>0?(y(),v("div",ke,[(y(!0),v(ne,null,re(c.value,r=>(y(),v("div",{key:r.id,class:"album-card card",onClick:U=>H(r.id)},[u("div",xe,[s(l(ve),{class:"cover-icon"}),u("span",Se,p(r.name),1)]),u("div",ze,[u("h3",Me,p(r.name),1),u("p",Pe,p(r.description),1),u("div",De,[u("span",Ne,p(l(fe)(r.created_at)),1),u("span",Ue,p(r.image_count)+" "+p(l(e)("albums.images")),1)])]),u("div",Fe,[u("div",Le,[w(p(l(e)("albums.galleryEnabled"))+"ï¼š ",1),r.gallery_enabled?(y(),v("span",$e,[s(l(z),{twoToneColor:"#52c41a"})])):(y(),v("span",je,[s(l(M),{twoToneColor:"#eb2f96"})]))]),s(b,{type:"text",size:"small",onClick:L(U=>G(r),["stop"])},{default:m(()=>[s(l(ue)),w(" "+p(l(e)("albums.edit")),1)]),_:1},8,["onClick"]),s(b,{type:"text",size:"small",danger:"",onClick:L(U=>J(r.id),["stop"])},{default:m(()=>[s(l(me)),w(" "+p(l(e)("albums.delete")),1)]),_:1},8,["onClick"])])],8,Te))),128))])):(y(),v("div",Ee,[u("div",Ie,[s(l(_e))]),u("h3",Re,p(l(e)("albums.noAlbums")),1),u("p",Be,p(l(e)("albums.createFirstAlbum")),1),s(b,{type:"primary",onClick:t[1]||(t[1]=r=>C.value=!0),class:"empty-button"},{icon:m(()=>[s(l(F))]),default:m(()=>[w(" "+p(l(e)("albums.createAlbum")),1)]),_:1})]))]),s(K,{open:C.value,"onUpdate:open":t[6]||(t[6]=r=>C.value=r),title:_.value?l(e)("albums.editAlbum"):l(e)("albums.createAlbum"),confirmLoading:O.value,onOk:q,onCancel:N},{default:m(()=>[s(Z,{model:i,rules:I,ref_key:"albumFormRef",ref:A},{default:m(()=>[s(k,{name:"serial_number",label:l(e)("albums.serialNumber")},{default:m(()=>[s(x,{value:i.serial_number,"onUpdate:value":t[2]||(t[2]=r=>i.serial_number=r),placeholder:l(e)("albums.enterSerialNumber"),min:"0",style:{width:"100%"}},null,8,["value","placeholder"])]),_:1},8,["label"]),s(k,{name:"name",label:l(e)("albums.albumName")},{default:m(()=>[s(Q,{value:i.name,"onUpdate:value":t[3]||(t[3]=r=>i.name=r),placeholder:l(e)("albums.enterAlbumName")},null,8,["value","placeholder"])]),_:1},8,["label"]),s(k,{name:"description",label:l(e)("albums.albumDescription")},{default:m(()=>[s(W,{value:i.description,"onUpdate:value":t[4]||(t[4]=r=>i.description=r),placeholder:l(e)("albums.enterAlbumDescription"),rows:"3"},null,8,["value","placeholder"])]),_:1},8,["label"]),s(k,{name:"gallery_enabled",label:l(e)("albums.galleryEnabled")},{default:m(()=>[s(X,{checked:i.gallery_enabled,"onUpdate:checked":t[5]||(t[5]=r=>i.gallery_enabled=r)},null,8,["checked"]),s(Y,{class:"gallery-tooltip",color:"var(--primary-color)",placement:"top",title:l(e)("albums.galleryTooltip")},{default:m(()=>[s(l(oe))]),_:1},8,["title"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title","confirmLoading"])])}}}),Xe=pe(Ve,[["__scopeId","data-v-126455b4"]]);export{Xe as default};
