import{d as Te,C as Be,j as Le,c as _,a as r,l as n,y as i,i as s,V as Re,t as u,k as I,x as T,E as h,Q as Z,R as ee,F as Q,r as q,f as g,H as G,e as ae,J as p,I as b,z as De,A as Ne,o as c,s as te,B as Ve,U as le,_ as Ee}from"./index-DmJlHfzr.js";import{b as K,i as B}from"./services-DL6wjq8D.js";import{a as oe,g as se,f as $e}from"./index-FacjB4mQ.js";import{g as U}from"./errorMessages-Dl98_79z.js";import{I as Pe}from"./ImagePreviewModal-D7J5hz2l.js";import{S as je,B as He,M as Je}from"./SelectOutlined-DzCe5kUX.js";import{U as ne}from"./UploadOutlined-CrVSn9-Z.js";import{C as Qe,A as qe}from"./CameraOutlined-DLqVI4kP.js";import{L as Ge}from"./LinkOutlined-CBwq_Ifv.js";import"./axios-Cl3Sb8ms.js";const Ke={class:"album-detail-container"},We={class:"album-detail-header card"},Xe={class:"header-left"},Ye={class:"album-info"},Ze={class:"header-title"},ea={class:"album-description"},aa={key:0,class:"album-meta"},ta={class:"album-date"},la={class:"album-count"},oa={key:1,class:"header-selector"},sa={class:"header-right"},na={key:0,class:"bottom-batch-actions"},ia={class:"bottom-batch-actions-content"},ra={class:"bottom-batch-actions-left"},ua={class:"bottom-selected-count"},da={class:"bottom-batch-actions-right"},ca={class:"batch-update-info"},ma={class:"album-detail-main"},pa={key:0,class:"images-grid"},ga=["onClick"],va={class:"image-container"},_a={class:"image-loader-container"},ba=["src","alt","onLoad","onError"],fa={key:0,class:"image-loading-spinner"},ha={class:"image-info"},ya={class:"image-filename"},ka={class:"image-meta"},Ca={class:"image-meta"},Aa={key:0,class:"image-tags"},Ia={key:1,class:"empty-state"},Ua={class:"empty-icon"},wa={class:"empty-title"},Sa={class:"empty-description"},Ma={key:2,class:"pagination-container"},xa=Te({__name:"AlbumDetailView",setup(Fa){const{t}=Be(),ie=De(),re=Ne(),L=ae(()=>parseInt(re.params.id)),S=g(null),m=g([]),d=g([]),W=g(!1),M=g(1),R=g(20),E=g(0),x=g(!1),F=g(!1),O=g(!1),D=g(!1),$=g(null),k=g(!1),C=g(null),w=G({album_id:""}),v=G({original_name:"",tags:""}),X=g([]),f=G({original_name:"",tags:""}),P=ae({get:()=>m.value.length>0&&d.value.length===m.value.length,set:l=>{l?d.value=m.value.map(e=>e.id):d.value=[]}}),ue=()=>{ie.push("/manage/albums")},de=()=>{k.value=!k.value,k.value||(d.value=[])},ce=l=>{$.value=l,D.value=!0},me=()=>{D.value=!1,$.value=null},pe=(l,e)=>{e?d.value.push(l):d.value=d.value.filter(o=>o!==l)},ge=l=>{P.value=l.target.checked},ve=async()=>{try{const l=await K.getUserAlbum(L.value);S.value=l.data}catch(l){const e=l.response?.data?.code,o=e?U(e):t("albums.fetchAlbumFailed");p.error(o)}},j=async()=>{try{W.value=!0;const l=new Set(m.value?.map(o=>o.id)||[]),e=await K.getUserAlbumImages(L.value,{page:M.value,page_size:R.value});m.value=(e.data.images||[]).map(o=>({...o,loaded:l.has(o.id)})),E.value=e.data.total,d.value=[]}catch(l){const e=l.response?.data?.code,o=e?U(e):t("albums.fetchImagesFailed");p.error(o)}finally{W.value=!1}},_e=()=>{d.value.length!==0&&le.confirm({title:t("albums.confirmBatchRemove"),content:t("albums.batchRemoveContent",{count:d.value.length}),onOk:async()=>{try{await B.removeImagesFromAlbum({album_id:L.value,ids:d.value}),p.success(t("albums.batchRemoveSuccess")),m.value=m.value.filter(l=>!d.value.includes(l.id)),d.value=[]}catch(l){const e=l.response?.data?.code,o=e?U(e):t("albums.batchRemoveFailed");p.error(o)}}})},be=async l=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(l),p.success(t("images.linkCopied"));else{const e=document.createElement("textarea");e.value=l,e.style.position="fixed",e.style.left="-9999px",e.style.top="0",document.body.appendChild(e),e.focus(),e.select();const o=document.execCommand("copy");document.body.removeChild(e),o?p.success(t("images.linkCopied")):p.error(t("images.copyLinkFailed"))}}catch{p.error(t("images.copyLinkFailed"))}},fe=(l,e)=>{switch(C.value=e,l){case"update":v.original_name=e.original_name||"",v.tags=e.tags?.join(",")||"",F.value=!0;break;case"addToAlbum":O.value=!0;break;case"copyLink":const o=se(e.file_url);be(o);break;case"delete":he(e.id);break}},he=l=>{le.confirm({title:t("albums.confirmRemove"),content:t("albums.removeContent"),onOk:async()=>{try{await B.removeImagesFromAlbum({album_id:L.value,ids:[l]}),p.success(t("albums.removeSuccess")),m.value=m.value.filter(e=>e.id!==l)}catch(e){const o=e.response?.data?.code,y=o?U(o):t("albums.removeFailed");p.error(y)}}})},ye=async()=>{if(C.value)try{const l=v.tags.split(",").map(o=>o.trim()).filter(Boolean),e={ids:[C.value.id],tags:l};v.original_name.trim()&&(e.original_name=v.original_name.trim()),await B.updateUserImage(e),p.success(t("images.updateSuccess")),m.value=m.value.map(o=>{if(o.id===C.value?.id){const y={...o,tags:l};return v.original_name.trim()&&(y.original_name=v.original_name.trim()),y}return o}),F.value=!1,v.original_name="",v.tags="",C.value=null}catch(l){const e=l.response?.data?.code,o=e?U(e):t("images.updateFailed");p.error(o)}},ke=async()=>{if(!(!C.value||!w.album_id))try{await B.addImagesToAlbum({album_id:parseInt(w.album_id.toString()),ids:[C.value.id]}),p.success(t("images.addToAlbumSuccess")),O.value=!1,w.album_id="",C.value=null}catch(l){const e=l.response?.data?.code,o=e?U(e):t("images.addToAlbumFailed");p.error(o)}},Ce=async()=>{try{const l=await K.getUserAlbums({page:1,page_size:100});X.value=l.data.albums}catch(l){const e=l.response?.data?.code,o=e?U(e):t("albums.fetchAlbumsFailed");p.error(o)}},Ae=async()=>{if(d.value.length)try{const l=f.tags.split(",").map(o=>o.trim()).filter(Boolean),e={ids:d.value,tags:l};f.original_name.trim()&&(e.original_name=f.original_name.trim()),await B.updateUserImage(e),p.success(t("images.batchUpdateSuccess")),m.value=m.value.map(o=>{if(d.value.includes(o.id)){const y={...o,tags:l};return f.original_name.trim()&&(y.original_name=f.original_name.trim()),y}return o}),x.value=!1,f.original_name="",f.tags=""}catch(l){const e=l.response?.data?.code,o=e?U(e):t("images.batchUpdateFailed");p.error(o)}},Ie=l=>{M.value=l,j()},Ue=(l,e)=>{R.value=e,M.value=1,j()};return Le(()=>{ve(),j(),Ce()}),(l,e)=>{const o=b("a-button"),y=b("a-checkbox"),Y=b("router-link"),N=b("a-input"),z=b("a-form-item"),H=b("a-form"),J=b("a-modal"),V=b("a-menu-item"),we=b("a-menu"),Se=b("a-dropdown"),Me=b("a-tag"),xe=b("a-pagination"),Fe=b("a-select-option"),Oe=b("a-select");return c(),_("div",Ke,[r("header",We,[r("div",Xe,[n(o,{type:"text",onClick:ue,class:"back-button"},{icon:i(()=>[n(s(Re))]),_:1}),r("div",Ye,[r("div",null,[r("h1",Ze,u(S.value?.name),1),r("span",ea,u(S.value?.description||s(t)("albums.noDescription")),1)]),S.value?(c(),_("div",aa,[r("span",ta,u(s(t)("albums.createdAt"))+" "+u(s(oe)(S.value.created_at)),1),r("span",la,u(m.value.length)+" "+u(s(t)("albums.images")),1)])):I("",!0),m.value.length>0?(c(),_("div",oa,[n(o,{type:k.value?"primary":"default",onClick:de,class:"multi-select-button"},{default:i(()=>[k.value?(c(),T(s(je),{key:0})):(c(),T(s(He),{key:1}))]),_:1},8,["type"]),k.value?(c(),T(y,{key:0,checked:P.value,"onUpdate:checked":e[0]||(e[0]=a=>P.value=a),onChange:ge,class:"header-checkbox"},{default:i(()=>[h(u(s(t)("images.selectAll")),1)]),_:1},8,["checked"])):I("",!0)])):I("",!0)])]),r("div",sa,[n(Y,{to:"/manage/upload"},{default:i(()=>[n(o,{type:"primary",class:"upload-button"},{icon:i(()=>[n(s(ne))]),default:i(()=>[h(" "+u(s(t)("images.uploadImage")),1)]),_:1})]),_:1})])]),d.value.length>0?(c(),_("div",na,[r("div",ia,[r("div",ra,[r("span",ua,u(s(t)("images.selectedCount",{count:d.value.length})),1)]),r("div",da,[n(o,{type:"default",onClick:e[1]||(e[1]=a=>x.value=!0),class:"bottom-batch-update-button"},{icon:i(()=>[n(s(Z))]),default:i(()=>[h(" "+u(s(t)("images.batchUpdate")),1)]),_:1}),n(o,{type:"danger",onClick:_e,class:"bottom-batch-remove-button"},{icon:i(()=>[n(s(ee))]),default:i(()=>[h(" "+u(s(t)("albums.batchRemove")),1)]),_:1})])])])):I("",!0),n(J,{open:x.value,"onUpdate:open":e[4]||(e[4]=a=>x.value=a),title:s(t)("images.batchUpdate"),onOk:Ae,onCancel:e[5]||(e[5]=a=>x.value=!1)},{default:i(()=>[n(H,{model:f},{default:i(()=>[n(z,{label:s(t)("images.imageName")},{default:i(()=>[n(N,{value:f.original_name,"onUpdate:value":e[2]||(e[2]=a=>f.original_name=a),placeholder:s(t)("images.enterImageNameOptional")},null,8,["value","placeholder"])]),_:1},8,["label"]),n(z,{label:s(t)("images.tags")},{default:i(()=>[n(N,{value:f.tags,"onUpdate:value":e[3]||(e[3]=a=>f.tags=a),placeholder:s(t)("images.enterTagsOptional")},null,8,["value","placeholder"])]),_:1},8,["label"]),r("div",ca,u(s(t)("images.updatingImages",{count:d.value.length})),1)]),_:1},8,["model"])]),_:1},8,["open","title"]),r("main",ma,[m.value.length>0?(c(),_("div",pa,[(c(!0),_(Q,null,q(m.value,a=>(c(),_("div",{key:a.id,class:"image-card",onClick:A=>!k.value&&ce(a)},[r("div",va,[k.value?(c(),_("div",{key:0,class:"image-checkbox",onClick:e[6]||(e[6]=te(()=>{},["stop"]))},[n(y,{checked:d.value.includes(a.id),onChange:A=>pe(a.id,A.target.checked)},null,8,["checked","onChange"])])):I("",!0),r("div",_a,[r("img",{src:s(se)(a.thumbnail_url),alt:a.original_name,class:Ve(["image-preview",{"image-loaded":a.loaded}]),onLoad:A=>a.loaded=!0,onError:A=>a.loaded=!0},null,42,ba),a.loaded?I("",!0):(c(),_("div",fa,[...e[18]||(e[18]=[r("div",{class:"spinner"},null,-1)])]))]),r("div",{class:"image-actions",onClick:e[7]||(e[7]=te(()=>{},["stop"]))},[n(Se,null,{overlay:i(()=>[n(we,{onClick:A=>fe(A.key,a)},{default:i(()=>[n(V,{key:"update"},{icon:i(()=>[n(s(Z))]),default:i(()=>[h(" "+u(s(t)("images.update")),1)]),_:1}),n(V,{key:"addToAlbum"},{icon:i(()=>[n(s(qe))]),default:i(()=>[h(" "+u(s(t)("images.addToAlbum")),1)]),_:1}),n(V,{key:"copyLink"},{icon:i(()=>[n(s(Ge))]),default:i(()=>[h(" "+u(s(t)("images.copyLink")),1)]),_:1}),n(V,{key:"delete",danger:""},{icon:i(()=>[n(s(ee))]),default:i(()=>[h(" "+u(s(t)("albums.remove")),1)]),_:1})]),_:1},8,["onClick"])]),default:i(()=>[n(o,{type:"text",class:"action-button"},{icon:i(()=>[n(s(Je))]),_:1})]),_:2},1024)])]),r("div",ha,[r("p",ya,u(a.original_name||a.file_name),1),r("p",ka,u(s($e)(a.file_size))+" â€¢ "+u(a.width)+" x "+u(a.height),1),r("p",Ca,u(s(oe)(a.created_at)),1),a.tags&&a.tags.length>0?(c(),_("div",Aa,[(c(!0),_(Q,null,q(a.tags,(A,ze)=>(c(),T(Me,{key:ze,size:"small",color:"blue"},{default:i(()=>[h(u(A),1)]),_:2},1024))),128))])):I("",!0)])],8,ga))),128))])):(c(),_("div",Ia,[r("div",Ua,[n(s(Qe))]),r("h3",wa,u(s(t)("albums.noImagesInAlbum")),1),r("p",Sa,u(s(t)("albums.uploadImagesPrompt")),1),n(Y,{to:"/manage/upload"},{default:i(()=>[n(o,{type:"primary",class:"empty-button"},{icon:i(()=>[n(s(ne))]),default:i(()=>[h(" "+u(s(t)("images.uploadImage")),1)]),_:1})]),_:1})])),E.value>0?(c(),_("div",Ma,[n(xe,{current:M.value,"onUpdate:current":e[8]||(e[8]=a=>M.value=a),"page-size":R.value,"onUpdate:pageSize":e[9]||(e[9]=a=>R.value=a),total:E.value,"show-size-changer":!0,"page-size-options":["10","20","50","100"],onChange:Ie,onShowSizeChange:Ue},null,8,["current","page-size","total"])])):I("",!0)]),n(Pe,{visible:D.value,image:$.value,"onUpdate:visible":e[10]||(e[10]=a=>D.value=a),onClose:me},null,8,["visible","image"]),n(J,{open:F.value,"onUpdate:open":e[13]||(e[13]=a=>F.value=a),title:s(t)("images.updateImage"),onOk:ye,onCancel:e[14]||(e[14]=a=>F.value=!1)},{default:i(()=>[n(H,{model:v},{default:i(()=>[n(z,{label:s(t)("images.imageName")},{default:i(()=>[n(N,{value:v.original_name,"onUpdate:value":e[11]||(e[11]=a=>v.original_name=a),placeholder:s(t)("images.enterImageName")},null,8,["value","placeholder"])]),_:1},8,["label"]),n(z,{label:s(t)("images.tags")},{default:i(()=>[n(N,{value:v.tags,"onUpdate:value":e[12]||(e[12]=a=>v.tags=a),placeholder:s(t)("images.enterTagsOptional")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title"]),n(J,{open:O.value,"onUpdate:open":e[16]||(e[16]=a=>O.value=a),title:s(t)("images.addToAlbum"),onOk:ke,onCancel:e[17]||(e[17]=a=>O.value=!1)},{default:i(()=>[n(H,{model:w},{default:i(()=>[n(z,{label:s(t)("images.selectAlbum")},{default:i(()=>[n(Oe,{value:w.album_id,"onUpdate:value":e[15]||(e[15]=a=>w.album_id=a),placeholder:s(t)("images.selectAlbumPlaceholder")},{default:i(()=>[(c(!0),_(Q,null,q(X.value,a=>(c(),T(Fe,{key:a.id,value:a.id},{default:i(()=>[h(u(a.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["open","title"])])}}}),$a=Ee(xa,[["__scopeId","data-v-5ec8f43b"]]);export{$a as default};
