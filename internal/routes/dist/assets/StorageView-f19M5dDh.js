import{d as ae,C as te,j as se,c as oe,a as p,l as o,i as n,t as c,x as l,E as _,P as re,Q as ne,R as le,m as F,X as q,f as m,H as de,J as d,U as z,I as i,o as ce,_ as ie}from"./index-QwL2gIV2.js";import{s as C}from"./services-DL6wjq8D.js";import{a as M}from"./index-FacjB4mQ.js";import{g as O}from"./errorMessages-CmCcllaB.js";import{L as ue}from"./LinkOutlined-CSKfWOCA.js";import"./axios-Cl3Sb8ms.js";const ge={class:"storage-view"},pe={class:"storage-content card"},me={class:"search-filter"},ve={class:"filter-buttons"},fe={class:"sort-controls"},_e={class:"sort-label"},be={class:"config-content"},he={class:"tip"},ye=ae({__name:"StorageView",setup(we){const{t:e}=te(),N=m(!1),R=m(!1),f=m({current:1,pageSize:10,total:0,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],showTotal:r=>`共 ${r} 条记录`}),D=m([]),B=m(""),k=m("created_at"),U=m("desc"),w=m(!1),x=m(),v=m(null),a=de({name:"",type:"webdav",config:{base_path:"/webdav/base/path",static_url:"https://dav.example.com/d",base_url:"https://dav.example.com",username:"example",password:"123456"}}),E={name:[{required:!0,message:()=>e("storages.enterStorageName"),trigger:"blur"}],type:[{required:!0,message:()=>e("storages.selectStorageType"),trigger:["blur","change"]}],config:{base_path:[{required:!0,message:()=>e("storages.enterBasePath"),trigger:"blur"}],static_url:[{required:!0,message:()=>e("storages.enterStaticUrl"),trigger:"blur"}],base_url:[{required:()=>a.type==="webdav",message:()=>e("storages.enterWebdavBaseUrl"),trigger:["blur","change"]}],username:[{required:()=>a.type==="webdav",message:()=>e("storages.enterWebdavUsername"),trigger:["blur","change"]}],password:[{required:!1,message:()=>e("storages.enterWebdavPassword"),trigger:["blur","change"]}]}},A=[{title:"ID",dataIndex:"id",key:"id",fixed:"start"},{title:e("storages.storageName"),dataIndex:"name",key:"name"},{title:e("storages.storageType"),key:"type",slots:{customRender:"type"}},{title:e("storages.config"),key:"config",slots:{customRender:"config"},ellipsis:!0,width:300},{title:e("storages.createdAt"),key:"created_at",slots:{customRender:"created_at"}},{title:e("storages.updatedAt"),key:"updated_at",slots:{customRender:"updated_at"}},{title:"操作",key:"actions",slots:{customRender:"actions"}}],b=async()=>{try{N.value=!0;const r=await C.getStorages({page:f.value.current,page_size:f.value.pageSize,searchkey:B.value,orderby:k.value,order:U.value});D.value=r.data,f.value.total=r.data.length}catch(r){const t=r.response?.data?.code,u=t?O(t):e("storages.fetchFailed");d.error(u)}finally{N.value=!1}},I=r=>{B.value=r,f.value.current=1,b()},P=()=>{f.value.current=1,b()},V=()=>{B.value="",k.value="created_at",U.value="desc",f.value.current=1,b()},L=r=>{f.value=r,b()},J=r=>{v.value=r,a.name=r.name,a.type=r.type,a.config=JSON.parse(JSON.stringify(r.config)),a.config.password==="[SET]"&&(a.config.password=""),w.value=!0},j=(r,t)=>{if(t==="local"){d.warning(e("storages.cannotDeleteLocalStorage"));return}z.confirm({title:e("storages.confirmDelete"),content:e("storages.deleteContent",{name:t}),onOk:async()=>{try{await C.deleteStorage(r),d.success(e("storages.deleteSuccess")),b()}catch(u){const g=u.response?.data?.code,T=g?O(g):e("storages.deleteFailed");d.error(T)}}})},H=r=>{z.confirm({title:e("storages.confirmTestConnection"),content:e("storages.testConnectionContent",{name:r.name}),onOk:async()=>{try{const t={name:r.name,type:r.type,config:r.config};t.config.password==="[SET]"&&(t.config.password=""),await C.testStorageConnection(t),d.success(e("storages.testConnectionSuccess"))}catch(t){const u=t.response?.data?.code,g=u?O(u):e("storages.testConnectionFailed");d.error(g)}}})},K=async()=>{if(x.value)try{if(!a.name){d.error(e("storages.enterStorageName"));return}if(!a.type){d.error(e("storages.selectStorageType"));return}if(!a.config.base_path){d.error(e("storages.enterBasePath"));return}if(!a.config.static_url){d.error(e("storages.enterStaticUrl"));return}if(a.type==="webdav"){if(!a.config.base_url){d.error(e("storages.enterWebdavBaseUrl"));return}if(!a.config.username){d.error(e("storages.enterWebdavUsername"));return}}R.value=!0;const r={name:a.name,type:a.type,config:a.config};v.value?(await C.updateStorage(v.value.id,r),d.success(e("storages.updateSuccess"))):(await C.createStorage(r),d.success(e("storages.createSuccess"))),W(),b()}catch(r){const t=r.response?.data?.code,u=t?O(t):e("storages.saveFailed");d.error(u)}finally{R.value=!1}},W=()=>{w.value=!1,v.value=null,a.name="",a.type="webdav",a.config={base_path:"/webdav/base/path",static_url:"https://dav.example.com/d",base_url:"https://dav.example.com",username:"example",password:"123456"},x.value&&x.value.resetFields()},Q=r=>r.base_url?`WebDAV: ${r.base_url} (${r.username})`:`Local: ${r.base_path} (${r.static_url})`;return se(()=>{b()}),(r,t)=>{const u=i("a-input-search"),g=i("a-select-option"),T=i("a-select"),S=i("a-button"),X=i("a-table"),y=i("a-input"),h=i("a-form-item"),G=i("a-radio"),Y=i("a-radio-group"),Z=i("a-form"),ee=i("a-modal");return ce(),oe("div",ge,[p("div",pe,[p("div",me,[o(u,{placeholder:n(e)("storages.search"),class:"search-input",onSearch:I},null,8,["placeholder"]),p("div",ve,[p("div",fe,[p("span",_e,c(n(e)("storages.sort")),1),o(T,{value:k.value,"onUpdate:value":t[0]||(t[0]=s=>k.value=s),class:"sort-select",style:{width:"120px"},onChange:P},{default:l(()=>[o(g,{value:"created_at"},{default:l(()=>[_(c(n(e)("storages.createdAt")),1)]),_:1}),o(g,{value:"updated_at"},{default:l(()=>[_(c(n(e)("storages.updatedAt")),1)]),_:1}),o(g,{value:"name"},{default:l(()=>[_(c(n(e)("storages.storageName")),1)]),_:1})]),_:1},8,["value"]),o(T,{value:U.value,"onUpdate:value":t[1]||(t[1]=s=>U.value=s),class:"sort-select",style:{width:"80px"},onChange:P},{default:l(()=>[o(g,{value:"desc"},{default:l(()=>[_(c(n(e)("admin.albums.sortOptions.desc")),1)]),_:1}),o(g,{value:"asc"},{default:l(()=>[_(c(n(e)("admin.albums.sortOptions.asc")),1)]),_:1})]),_:1},8,["value"])]),o(S,{type:"text",onClick:V},{default:l(()=>[_(c(n(e)("storages.resetFilters")),1)]),_:1}),o(S,{type:"primary",onClick:t[2]||(t[2]=s=>w.value=!0),class:"create-button"},{icon:l(()=>[o(n(re))]),default:l(()=>[_(" "+c(n(e)("storages.createStorage")),1)]),_:1})])]),o(X,{columns:A,"data-source":D.value,loading:N.value,pagination:f.value,onChange:L,"row-key":"id"},{type:l(({record:s})=>[p("span",null,c(s.type),1)]),config:l(({record:s})=>[p("span",be,c(Q(s.config)),1)]),created_at:l(({record:s})=>[p("span",null,c(n(M)(s.created_at)),1)]),updated_at:l(({record:s})=>[p("span",null,c(n(M)(s.updated_at)),1)]),actions:l(({record:s})=>[o(S,{type:"text",size:"small",onClick:$=>J(s),disabled:s.name==="local"},{default:l(()=>[o(n(ne))]),_:1},8,["onClick","disabled"]),o(S,{type:"text",size:"small",onClick:$=>H(s),disabled:s.name==="local"},{default:l(()=>[o(n(ue))]),_:1},8,["onClick","disabled"]),o(S,{type:"text",size:"small",danger:"",onClick:$=>j(s.id,s.name),disabled:s.name==="local"},{default:l(()=>[o(n(le))]),_:1},8,["onClick","disabled"])]),_:1},8,["data-source","loading","pagination"]),p("span",he,c(n(e)("storages.localStorageTip")),1)]),o(ee,{open:w.value,"onUpdate:open":t[10]||(t[10]=s=>w.value=s),title:v.value?n(e)("storages.edit"):n(e)("storages.createStorage"),"confirm-loading":R.value,onOk:K,onCancel:W},{default:l(()=>[o(Z,{model:a,rules:E,ref_key:"storageFormRef",ref:x},{default:l(()=>[o(h,{name:"name",label:n(e)("storages.storageName")},{default:l(()=>[o(y,{value:a.name,"onUpdate:value":t[3]||(t[3]=s=>a.name=s),placeholder:n(e)("storages.enterStorageName"),disabled:v.value&&v.value.name==="local"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),o(h,{name:"type",label:n(e)("storages.storageType")},{default:l(()=>[o(Y,{value:a.type,"onUpdate:value":t[4]||(t[4]=s=>a.type=s),disabled:v.value&&v.value.name==="local"},{default:l(()=>[o(G,{value:"webdav"},{default:l(()=>[_(c(n(e)("storages.webdavStorage")),1)]),_:1})]),_:1},8,["value","disabled"])]),_:1},8,["label"]),o(h,{name:"config.base_path",label:n(e)("storages.basePath")},{default:l(()=>[o(y,{value:a.config.base_path,"onUpdate:value":t[5]||(t[5]=s=>a.config.base_path=s),placeholder:n(e)("storages.enterBasePath")},null,8,["value","placeholder"])]),_:1},8,["label"]),o(h,{name:"config.static_url",label:n(e)("storages.staticUrl")},{default:l(()=>[o(y,{value:a.config.static_url,"onUpdate:value":t[6]||(t[6]=s=>a.config.static_url=s),placeholder:n(e)("storages.enterStaticUrl")},null,8,["value","placeholder"])]),_:1},8,["label"]),F(o(h,{name:"config.base_url",label:n(e)("storages.webdavBaseUrl")},{default:l(()=>[o(y,{value:a.config.base_url,"onUpdate:value":t[7]||(t[7]=s=>a.config.base_url=s),placeholder:n(e)("storages.enterWebdavBaseUrl")},null,8,["value","placeholder"])]),_:1},8,["label"]),[[q,a.type==="webdav"]]),F(o(h,{name:"config.username",label:n(e)("storages.webdavUsername")},{default:l(()=>[o(y,{value:a.config.username,"onUpdate:value":t[8]||(t[8]=s=>a.config.username=s),placeholder:n(e)("storages.enterWebdavUsername")},null,8,["value","placeholder"])]),_:1},8,["label"]),[[q,a.type==="webdav"]]),F(o(h,{name:"config.password",label:n(e)("storages.webdavPassword")},{default:l(()=>[o(y,{value:a.config.password,"onUpdate:value":t[9]||(t[9]=s=>a.config.password=s),placeholder:n(e)("storages.enterWebdavPassword")+" (留空保持原密码)"},null,8,["value","placeholder"])]),_:1},8,["label"]),[[q,a.type==="webdav"]])]),_:1},8,["model"])]),_:1},8,["open","title","confirm-loading"])])}}}),Oe=ie(ye,[["__scopeId","data-v-a3dba2aa"]]);export{Oe as default};
